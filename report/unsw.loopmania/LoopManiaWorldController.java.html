<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LoopManiaWorldController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCo Coverage Report</a> &gt; <a href="index.source.html" class="el_package">unsw.loopmania</a> &gt; <span class="el_source">LoopManiaWorldController.java</span></div><h1>LoopManiaWorldController.java</h1><pre class="source lang-java linenums">package unsw.loopmania;

import java.util.ArrayList;
import java.util.List;
import java.util.Random;


import org.codefx.libfx.listener.handle.ListenerHandle;
import org.codefx.libfx.listener.handle.ListenerHandles;

import javafx.animation.Animation;
import javafx.animation.KeyFrame;
import javafx.animation.Timeline;
import javafx.beans.property.SimpleIntegerProperty;
import javafx.beans.value.ChangeListener;
import javafx.beans.value.ObservableValue;
import javafx.event.EventHandler;
import javafx.fxml.FXML;
import javafx.geometry.Insets;
import javafx.geometry.Point2D;
import javafx.geometry.Pos;
import javafx.geometry.Rectangle2D;
import javafx.scene.Node;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.input.ClipboardContent;
import javafx.scene.input.DragEvent;
import javafx.scene.input.Dragboard;
import javafx.scene.input.KeyEvent;
import javafx.scene.input.MouseEvent;
import javafx.scene.input.TransferMode;
import javafx.scene.layout.AnchorPane;
import javafx.scene.layout.GridPane;
import javafx.scene.layout.HBox;
import javafx.scene.paint.Color;
import javafx.util.Duration;
import javafx.scene.control.Label;
import java.util.EnumMap;
import javafx.stage.Stage;
import javafx.scene.text.Font;
import javafx.scene.text.FontWeight;
<<<<<<< HEAD
import javafx.scene.text.Text;
=======
>>>>>>> master

import java.io.File;
import java.io.IOException;

/**
 * the draggable types.
 * If you add more draggable types, add an enum value here.
 * This is so we can see what type is being dragged.
 */
<<<<<<< HEAD
<span class="nc" id="L52">enum DRAGGABLE_TYPE{</span>
<span class="nc" id="L53">    CARD,</span>
<span class="nc" id="L54">    ITEM</span>
=======
<span class="nc" id="L51">enum DRAGGABLE_TYPE{</span>
<span class="nc" id="L52">    CARD,</span>
<span class="nc" id="L53">    ITEM</span>
>>>>>>> master
}


/**
 * card types
 */
<<<<<<< HEAD
<span class="nc" id="L61">enum CARDS_TYPE{</span>
<span class="nc" id="L62">    TOWER, ZOMBIEPIT,VAMPIRECASTLE, BARRACK, VILLAGE, TRAP, CAMPFIRE</span>
=======
<span class="nc" id="L60">enum CARDS_TYPE{</span>
<span class="nc" id="L61">    TOWER, ZOMBIEPIT,VAMPIRECASTLE, BARRACK, VILLAGE, TRAP, CAMPFIRE</span>
>>>>>>> master
}

/**
 * equiment type
 */ 
<<<<<<< HEAD
<span class="nc" id="L68">enum ITEMS_TYPE{</span>
<span class="nc" id="L69">    SWORD, STAKE, STAFF, ARMOUR, SHIELD, HELMET, THEONERING, HEALTHPOTION</span>
=======
<span class="nc" id="L67">enum ITEMS_TYPE{</span>
<span class="nc" id="L68">    SWORD, STAKE, STAFF, ARMOUR, SHIELD, HELMET, THEONERING, HEALTHPOTION</span>
>>>>>>> master
}

/**
 * A JavaFX controller for the world.
 * 
 * All event handlers and the timeline in JavaFX run on the JavaFX application thread:
 *     https://examples.javacodegeeks.com/desktop-java/javafx/javafx-concurrency-example/
 *     Note in https://openjfx.io/javadoc/11/javafx.graphics/javafx/application/Application.html under heading &quot;Threading&quot;, it specifies animation timelines are run in the application thread.
 * This means that the starter code does not need locks (mutexes) for resources shared between the timeline KeyFrame, and all of the  event handlers (including between different event handlers).
 * This will make the game easier for you to implement. However, if you add time-consuming processes to this, the game may lag or become choppy.
 * 
 * If you need to implement time-consuming processes, we recommend:
 *     using Task https://openjfx.io/javadoc/11/javafx.graphics/javafx/concurrent/Task.html by itself or within a Service https://openjfx.io/javadoc/11/javafx.graphics/javafx/concurrent/Service.html
 * 
 *     Tasks ensure that any changes to public properties, change notifications for errors or cancellation, event handlers, and states occur on the JavaFX Application thread,
 *         so is a better alternative to using a basic Java Thread: https://docs.oracle.com/javafx/2/threads/jfxpub-threads.htm
 *     The Service class is used for executing/reusing tasks. You can run tasks without Service, however, if you don't need to reuse it.
 *
 * If you implement time-consuming processes in a Task or thread, you may need to implement locks on resources shared with the application thread (i.e. Timeline KeyFrame and drag Event handlers).
 * You can check whether code is running on the JavaFX application thread by running the helper method printThreadingNotes in this class.
 * 
 * NOTE: http://tutorials.jenkov.com/javafx/concurrency.html and https://www.developer.com/design/multithreading-in-javafx/#:~:text=JavaFX%20has%20a%20unique%20set,in%20the%20JavaFX%20Application%20Thread.
 * 
 * If you need to delay some code but it is not long-running, consider using Platform.runLater https://openjfx.io/javadoc/11/javafx.graphics/javafx/application/Platform.html#runLater(java.lang.Runnable)
 *     This is run on the JavaFX application thread when it has enough time.
 */
public class LoopManiaWorldController {

    /**
     * squares gridpane includes path images, enemies, character, empty grass, buildings
     */
    @FXML
    private GridPane squares;

    /**
     * cards gridpane includes cards and the ground underneath the cards
     */
    @FXML
    private GridPane cards;

    /**
     * anchorPaneRoot is the &quot;background&quot;. It is useful since anchorPaneRoot stretches over the entire game world,
     * so we can detect dragging of cards/items over this and accordingly update DragIcon coordinates
     */
    @FXML
    private AnchorPane anchorPaneRoot;

    /**
     * equippedItems gridpane is for equipped items (e.g. swords, shield, axe)
     */
    @FXML
    private GridPane equippedItems;

    @FXML
    private GridPane unequippedInventory;

    @FXML
    private GridPane characterInfo;
    
    @FXML
    private AnchorPane stats;

    @FXML
    private Label roundsNumLabel;
    // all image views including tiles, character, enemies, cards... even though cards in separate gridpane...
    private List&lt;ImageView&gt; entityImages;

    /**
     * when we drag a card/item, the picture for whatever we're dragging is set here and we actually drag this node
     */
    private DragIcon draggedEntity;

    private boolean isPaused;
    private LoopManiaWorld world;

    /**
     * runs the periodic game logic - second-by-second moving of character through maze, as well as enemies, and running of battles
     */
    private Timeline timeline;

    private Image towerCardImage;
    private Image zombiePitCardImage;
    private Image vampireCastleCardImage;
    private Image barrackCardImage;
    private Image villageCardImage;
    private Image trapCardImage;
    private Image campfireCardImage;
    private Image basicEnemyImage;
    private Image zombieImage;
    private Image vampireImage;
    private Image swordImage;

    private Image towerBuildingImage;
    private Image zombiePitBuildingImage;
    private Image vampireCastleBuildingImage;
    private Image barrackBuildingImage;
    private Image villageBuildingImage;
    private Image trapBuildingImage;
    private Image campfireBuildingImage;
    private Image stakeImage;
    private Image staffImage;
    private Image armourImage;
    private Image shieldImage;
    private Image helmetImage;
    private Image theOneRingImage;
<<<<<<< HEAD
    private Image BlackTinyImage;
=======
    private Image emptyTheOneRingImage;
>>>>>>> master
    
    private Image heroCastlImage;

    private Image heartImage;
    private Image goldPileslImage;
    /**
     * the image currently being dragged, if there is one, otherwise null.
     * Holding the ImageView being dragged allows us to spawn it again in the drop location if appropriate.
     */
    private ImageView currentlyDraggedImage;
    
    /**
     * null if nothing being dragged, or the type of item being dragged
     */
    private DRAGGABLE_TYPE currentlyDraggedType;

    /**
     * mapping from draggable type enum CARD/TYPE to the event handler triggered when the draggable type is dropped over its appropriate gridpane
     */
    private EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt; gridPaneSetOnDragDropped;
    /**
     * mapping from draggable type enum CARD/TYPE to the event handler triggered when the draggable type is dragged over the background
     */
    private EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt; anchorPaneRootSetOnDragOver;
    /**
     * mapping from draggable type enum CARD/TYPE to the event handler triggered when the draggable type is dropped in the background
     */
    private EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt; anchorPaneRootSetOnDragDropped;
    /**
     * mapping from draggable type enum CARD/TYPE to the event handler triggered when the draggable type is dragged into the boundaries of its appropriate gridpane
     */
    private EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt; gridPaneNodeSetOnDragEntered;
    /**
     * mapping from draggable type enum CARD/TYPE to the event handler triggered when the draggable type is dragged outside of the boundaries of its appropriate gridpane
     */
    private EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt; gridPaneNodeSetOnDragExited;

    /**
     * object handling switching to the main menu
     */
    private MenuSwitcher mainMenuSwitcher;

    private HeroCastleBuilding heroCastleBuilding;


    private CardDescription cardDescription;

    private Stage primaryStage;

    private boolean isSurvivalMode;

    private Label healthPointText;
    private Label goldText;
    private Label expText;
    
    private MainMenuController mainMenuController;

    /**
     * @param world world object loaded from file
     * @param initialEntities the initial JavaFX nodes (ImageViews) which should be loaded into the GUI
     */
<<<<<<< HEAD
<span class="nc" id="L237">    public LoopManiaWorldController(LoopManiaWorld world, List&lt;ImageView&gt; initialEntities) {</span>
<span class="nc" id="L238">        this.world = world;</span>
<span class="nc" id="L239">        entityImages = new ArrayList&lt;&gt;(initialEntities);</span>
<span class="nc" id="L240">        towerCardImage = new Image((new File(&quot;src/images/tower_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L241">        zombiePitCardImage = new Image((new File(&quot;src/images/zombie_pit_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L242">        vampireCastleCardImage = new Image((new File(&quot;src/images/vampire_castle_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L243">        barrackCardImage = new Image((new File(&quot;src/images/barracks_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L244">        villageCardImage = new Image((new File(&quot;src/images/village_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L245">        trapCardImage = new Image((new File(&quot;src/images/trap_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L246">        campfireCardImage = new Image((new File(&quot;src/images/campfire_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L247">        basicEnemyImage = new Image((new File(&quot;src/images/slug.png&quot;)).toURI().toString());</span>
<span class="nc" id="L248">        zombieImage = new Image((new File(&quot;src/images/zombie.png&quot;)).toURI().toString());</span>
<span class="nc" id="L249">        vampireImage = new Image((new File(&quot;src/images/vampire.png&quot;)).toURI().toString());</span>
<span class="nc" id="L250">        swordImage = new Image((new File(&quot;src/images/basic_sword.png&quot;)).toURI().toString());</span>

<span class="nc" id="L252">        towerBuildingImage = new Image((new File(&quot;src/images/tower.png&quot;)).toURI().toString());</span>
<span class="nc" id="L253">        zombiePitBuildingImage = new Image((new File(&quot;src/images/zombie_pit.png&quot;)).toURI().toString());</span>
<span class="nc" id="L254">        vampireCastleBuildingImage = new Image((new File(&quot;src/images/vampire_castle_building_purple_background.png&quot;)).toURI().toString());</span>
<span class="nc" id="L255">        barrackBuildingImage = new Image((new File(&quot;src/images/barracks.png&quot;)).toURI().toString());</span>
<span class="nc" id="L256">        villageBuildingImage = new Image((new File(&quot;src/images/village.png&quot;)).toURI().toString());</span>
<span class="nc" id="L257">        trapBuildingImage = new Image((new File(&quot;src/images/trap.png&quot;)).toURI().toString());</span>
<span class="nc" id="L258">        campfireBuildingImage = new Image((new File(&quot;src/images/campfire.png&quot;)).toURI().toString());</span>
<span class="nc" id="L259">        heroCastlImage = new Image((new File(&quot;src/images/heros_castle.png&quot;)).toURI().toString());</span>

<span class="nc" id="L261">        stakeImage = new Image((new File(&quot;src/images/stake.png&quot;)).toURI().toString());</span>
<span class="nc" id="L262">        staffImage = new Image((new File(&quot;src/images/staff.png&quot;)).toURI().toString());</span>
<span class="nc" id="L263">        armourImage = new Image((new File(&quot;src/images/armour.png&quot;)).toURI().toString());</span>
<span class="nc" id="L264">        shieldImage = new Image((new File(&quot;src/images/shield.png&quot;)).toURI().toString());</span>
<span class="nc" id="L265">        helmetImage = new Image((new File(&quot;src/images/helmet.png&quot;)).toURI().toString());</span>
<span class="nc" id="L266">        theOneRingImage = new Image((new File(&quot;src/images/the_one_ring.png&quot;)).toURI().toString());</span>
<span class="nc" id="L267">        BlackTinyImage = new Image((new File(&quot;src/images/image_just_black_tiny.png&quot;)).toURI().toString());</span>
<span class="nc" id="L268">        heartImage= new Image((new File(&quot;src/images/heart.png&quot;)).toURI().toString());</span>
<span class="nc" id="L269">        goldPileslImage = new Image((new File(&quot;src/images/gold_pile.png&quot;)).toURI().toString());</span>
<span class="nc" id="L270">        currentlyDraggedImage = null;</span>
<span class="nc" id="L271">        currentlyDraggedType = null;</span>

        // initialize them all...
<span class="nc" id="L274">        gridPaneSetOnDragDropped = new EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt;(DRAGGABLE_TYPE.class);</span>
<span class="nc" id="L275">        anchorPaneRootSetOnDragOver = new EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt;(DRAGGABLE_TYPE.class);</span>
<span class="nc" id="L276">        anchorPaneRootSetOnDragDropped = new EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt;(DRAGGABLE_TYPE.class);</span>
<span class="nc" id="L277">        gridPaneNodeSetOnDragEntered = new EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt;(DRAGGABLE_TYPE.class);</span>
<span class="nc" id="L278">        gridPaneNodeSetOnDragExited = new EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt;(DRAGGABLE_TYPE.class);</span>
<span class="nc" id="L279">    }</span>
=======
<span class="nc" id="L236">    public LoopManiaWorldController(LoopManiaWorld world, List&lt;ImageView&gt; initialEntities) {</span>
<span class="nc" id="L237">        this.world = world;</span>
<span class="nc" id="L238">        entityImages = new ArrayList&lt;&gt;(initialEntities);</span>
<span class="nc" id="L239">        towerCardImage = new Image((new File(&quot;src/images/tower_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L240">        zombiePitCardImage = new Image((new File(&quot;src/images/zombie_pit_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L241">        vampireCastleCardImage = new Image((new File(&quot;src/images/vampire_castle_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L242">        barrackCardImage = new Image((new File(&quot;src/images/barracks_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L243">        villageCardImage = new Image((new File(&quot;src/images/village_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L244">        trapCardImage = new Image((new File(&quot;src/images/trap_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L245">        campfireCardImage = new Image((new File(&quot;src/images/campfire_card.png&quot;)).toURI().toString());</span>
<span class="nc" id="L246">        basicEnemyImage = new Image((new File(&quot;src/images/slug.png&quot;)).toURI().toString());</span>
<span class="nc" id="L247">        zombieImage = new Image((new File(&quot;src/images/zombie.png&quot;)).toURI().toString());</span>
<span class="nc" id="L248">        vampireImage = new Image((new File(&quot;src/images/vampire.png&quot;)).toURI().toString());</span>
<span class="nc" id="L249">        swordImage = new Image((new File(&quot;src/images/basic_sword.png&quot;)).toURI().toString());</span>

<span class="nc" id="L251">        towerBuildingImage = new Image((new File(&quot;src/images/tower.png&quot;)).toURI().toString());</span>
<span class="nc" id="L252">        zombiePitBuildingImage = new Image((new File(&quot;src/images/zombie_pit.png&quot;)).toURI().toString());</span>
<span class="nc" id="L253">        vampireCastleBuildingImage = new Image((new File(&quot;src/images/vampire_castle_building_purple_background.png&quot;)).toURI().toString());</span>
<span class="nc" id="L254">        barrackBuildingImage = new Image((new File(&quot;src/images/barracks.png&quot;)).toURI().toString());</span>
<span class="nc" id="L255">        villageBuildingImage = new Image((new File(&quot;src/images/village.png&quot;)).toURI().toString());</span>
<span class="nc" id="L256">        trapBuildingImage = new Image((new File(&quot;src/images/trap.png&quot;)).toURI().toString());</span>
<span class="nc" id="L257">        campfireBuildingImage = new Image((new File(&quot;src/images/campfire.png&quot;)).toURI().toString());</span>
<span class="nc" id="L258">        heroCastlImage = new Image((new File(&quot;src/images/heros_castle.png&quot;)).toURI().toString());</span>

<span class="nc" id="L260">        stakeImage = new Image((new File(&quot;src/images/stake.png&quot;)).toURI().toString());</span>
<span class="nc" id="L261">        staffImage = new Image((new File(&quot;src/images/staff.png&quot;)).toURI().toString());</span>
<span class="nc" id="L262">        armourImage = new Image((new File(&quot;src/images/armour.png&quot;)).toURI().toString());</span>
<span class="nc" id="L263">        shieldImage = new Image((new File(&quot;src/images/shield.png&quot;)).toURI().toString());</span>
<span class="nc" id="L264">        helmetImage = new Image((new File(&quot;src/images/helmet.png&quot;)).toURI().toString());</span>
<span class="nc" id="L265">        theOneRingImage = new Image((new File(&quot;src/images/the_one_ring.png&quot;)).toURI().toString());</span>
<span class="nc" id="L266">        emptyTheOneRingImage = new Image((new File(&quot;src/images/src_images_the_one_ring.png&quot;)).toURI().toString());</span>
<span class="nc" id="L267">        heartImage= new Image((new File(&quot;src/images/heart.png&quot;)).toURI().toString());</span>
<span class="nc" id="L268">        goldPileslImage = new Image((new File(&quot;src/images/gold_pile.png&quot;)).toURI().toString());</span>
<span class="nc" id="L269">        currentlyDraggedImage = null;</span>
<span class="nc" id="L270">        currentlyDraggedType = null;</span>

        // initialize them all...
<span class="nc" id="L273">        gridPaneSetOnDragDropped = new EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt;(DRAGGABLE_TYPE.class);</span>
<span class="nc" id="L274">        anchorPaneRootSetOnDragOver = new EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt;(DRAGGABLE_TYPE.class);</span>
<span class="nc" id="L275">        anchorPaneRootSetOnDragDropped = new EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt;(DRAGGABLE_TYPE.class);</span>
<span class="nc" id="L276">        gridPaneNodeSetOnDragEntered = new EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt;(DRAGGABLE_TYPE.class);</span>
<span class="nc" id="L277">        gridPaneNodeSetOnDragExited = new EnumMap&lt;DRAGGABLE_TYPE, EventHandler&lt;DragEvent&gt;&gt;(DRAGGABLE_TYPE.class);</span>
<span class="nc" id="L278">    }</span>
>>>>>>> master

    @FXML
    public void initialize() {
        // TODO = load more images/entities during initialization
        
<<<<<<< HEAD
<span class="nc" id="L285">        Image pathTilesImage = new Image((new File(&quot;src/images/32x32GrassAndDirtPath.png&quot;)).toURI().toString());</span>
<span class="nc" id="L286">        Image inventorySlotImage = new Image((new File(&quot;src/images/empty_slot.png&quot;)).toURI().toString());</span>
<span class="nc" id="L287">        Rectangle2D imagePart = new Rectangle2D(0, 0, 32, 32);</span>

        // Add the ground first so it is below all other entities (inculding all the twists and turns)
<span class="nc bnc" id="L290" title="All 2 branches missed.">        for (int x = 0; x &lt; world.getWidth(); x++) {</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">            for (int y = 0; y &lt; world.getHeight(); y++) {</span>
<span class="nc" id="L292">                ImageView groundView = new ImageView(pathTilesImage);</span>
<span class="nc" id="L293">                groundView.setViewport(imagePart);</span>
<span class="nc" id="L294">                squares.add(groundView, x, y);</span>
=======
<span class="nc" id="L284">        Image pathTilesImage = new Image((new File(&quot;src/images/32x32GrassAndDirtPath.png&quot;)).toURI().toString());</span>
<span class="nc" id="L285">        Image inventorySlotImage = new Image((new File(&quot;src/images/empty_slot.png&quot;)).toURI().toString());</span>
<span class="nc" id="L286">        Rectangle2D imagePart = new Rectangle2D(0, 0, 32, 32);</span>

        // Add the ground first so it is below all other entities (inculding all the twists and turns)
<span class="nc bnc" id="L289" title="All 2 branches missed.">        for (int x = 0; x &lt; world.getWidth(); x++) {</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">            for (int y = 0; y &lt; world.getHeight(); y++) {</span>
<span class="nc" id="L291">                ImageView groundView = new ImageView(pathTilesImage);</span>
<span class="nc" id="L292">                groundView.setViewport(imagePart);</span>
<span class="nc" id="L293">                squares.add(groundView, x, y);</span>
>>>>>>> master
            }
        }

        // load entities loaded from the file in the loader into the squares gridpane
<<<<<<< HEAD
<span class="nc bnc" id="L299" title="All 2 branches missed.">        for (ImageView entity : entityImages){</span>
<span class="nc" id="L300">            squares.getChildren().add(entity);</span>
<span class="nc" id="L301">        }</span>

        // add the ground underneath the cards
<span class="nc bnc" id="L304" title="All 2 branches missed.">        for (int x=0; x&lt;world.getWidth(); x++){</span>
<span class="nc" id="L305">            ImageView groundView = new ImageView(pathTilesImage);</span>
<span class="nc" id="L306">            groundView.setViewport(imagePart);</span>
<span class="nc" id="L307">            cards.add(groundView, x, 0);</span>
        }

        // add the empty slot images for the unequipped inventory
<span class="nc bnc" id="L311" title="All 2 branches missed.">        for (int x=0; x&lt;LoopManiaWorld.unequippedInventoryWidth; x++){</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">            for (int y=0; y&lt;LoopManiaWorld.unequippedInventoryHeight; y++){</span>
<span class="nc" id="L313">                ImageView emptySlotView = new ImageView(inventorySlotImage);</span>
<span class="nc" id="L314">                unequippedInventory.add(emptySlotView, x, y);</span>
=======
<span class="nc bnc" id="L298" title="All 2 branches missed.">        for (ImageView entity : entityImages){</span>
<span class="nc" id="L299">            squares.getChildren().add(entity);</span>
<span class="nc" id="L300">        }</span>

        // add the ground underneath the cards
<span class="nc bnc" id="L303" title="All 2 branches missed.">        for (int x=0; x&lt;world.getWidth(); x++){</span>
<span class="nc" id="L304">            ImageView groundView = new ImageView(pathTilesImage);</span>
<span class="nc" id="L305">            groundView.setViewport(imagePart);</span>
<span class="nc" id="L306">            cards.add(groundView, x, 0);</span>
        }

        // add the empty slot images for the unequipped inventory
<span class="nc bnc" id="L310" title="All 2 branches missed.">        for (int x=0; x&lt;LoopManiaWorld.unequippedInventoryWidth; x++){</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">            for (int y=0; y&lt;LoopManiaWorld.unequippedInventoryHeight; y++){</span>
<span class="nc" id="L312">                ImageView emptySlotView = new ImageView(inventorySlotImage);</span>
<span class="nc" id="L313">                unequippedInventory.add(emptySlotView, x, y);</span>
>>>>>>> master
            }
        }

        // create the draggable icon
<<<<<<< HEAD
<span class="nc" id="L319">        draggedEntity = new DragIcon();</span>
<span class="nc" id="L320">        draggedEntity.setVisible(false);</span>
<span class="nc" id="L321">        draggedEntity.setOpacity(0.7);</span>
<span class="nc" id="L322">        anchorPaneRoot.getChildren().add(draggedEntity);</span>

<span class="nc" id="L324">    }</span>
=======
<span class="nc" id="L318">        draggedEntity = new DragIcon();</span>
<span class="nc" id="L319">        draggedEntity.setVisible(false);</span>
<span class="nc" id="L320">        draggedEntity.setOpacity(0.7);</span>
<span class="nc" id="L321">        anchorPaneRoot.getChildren().add(draggedEntity);</span>

<span class="nc" id="L323">    }</span>
>>>>>>> master

    /**
     * create and run the timer
     */
    public void startTimer(){
<<<<<<< HEAD
<span class="nc" id="L330">        System.out.println(&quot;starting timer&quot;);</span>
<span class="nc" id="L331">        isPaused = false;</span>
        
        // trigger adding code to process main game logic to queue. JavaFX will target framerate of 0.3 seconds
<span class="nc bnc" id="L334" title="All 2 branches missed.">        if(timeline == null){</span>
<span class="nc" id="L335">            timeline = new Timeline(new KeyFrame(Duration.seconds(0.3), event -&gt; {</span>
                // check whether the position is in the Hero's Castle
<span class="nc bnc" id="L337" title="All 2 branches missed.">                if(world.getRoundsNum()== 0){</span>
<span class="nc" id="L338">                    world.addRoundsNum();</span>
                }else{
<span class="nc bnc" id="L340" title="All 2 branches missed.">                    if(heroCastleBuilding.work(world.getCharacter(),this)) return;</span>
                }
<span class="nc" id="L342">                world.runTickMoves();</span>

<span class="nc" id="L344">                Item item = world.getLastUnequippedInventoryItem();</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">                if (item != null) {</span>
<span class="nc" id="L346">                    onLoad(item);</span>
                }
<span class="nc" id="L348">                Card card = world.getLastCardEntity();</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">                if (card != null) {</span>
<span class="nc" id="L350">                    onLoad(card);</span>
                }

<span class="nc bnc" id="L353" title="All 2 branches missed.">                if (world.GetUsedTheOneRing()) {</span>
<span class="nc" id="L354">                    setUsedTheOneRingImage();</span>
                }

<span class="nc" id="L357">                List&lt;BasicEnemy&gt; deadEnemies = world.buildingFunction();</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">                for (BasicEnemy e: deadEnemies){</span>
<span class="nc" id="L359">                    reactToEnemyDefeat(e);</span>
<span class="nc" id="L360">                }</span>

<span class="nc" id="L362">                List&lt;BasicEnemy&gt; defeatedEnemies = world.runBattles();</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">                for (BasicEnemy e: defeatedEnemies){</span>
<span class="nc" id="L364">                    reactToEnemyDefeat(e);</span>
<span class="nc" id="L365">                }</span>
<span class="nc" id="L366">                List&lt;BasicEnemy&gt; newEnemies = world.possiblySpawnEnemies();</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">                for (BasicEnemy newEnemy: newEnemies){</span>
<span class="nc" id="L368">                    onLoad(newEnemy);</span>
<span class="nc" id="L369">                }</span>
                // update the display
<span class="nc" id="L371">                updateDisplay();</span>
<span class="nc" id="L372">                printThreadingNotes(&quot;HANDLED TIMER&quot;);</span>
<span class="nc" id="L373">            }));</span>
<span class="nc" id="L374">            timeline.setCycleCount(Animation.INDEFINITE);</span>
 
            // build up the hero castle building
<span class="nc" id="L377">            heroCastleBuilding = new HeroCastleBuilding(new SimpleIntegerProperty(0), </span>
             new SimpleIntegerProperty(0), this);
<span class="nc" id="L379">            addHeroCastle(heroCastleBuilding);</span>

            // build up the card descripton
<span class="nc" id="L382">            cardDescription = new CardDescription(this);</span>

<span class="nc" id="L384">            roundsNumLabel.setPadding(new Insets(0,0,0,10));</span>
            // init the display of heath point, gold and exp
<span class="nc" id="L386">            characterInfo.getChildren().clear();</span>
<span class="nc" id="L387">            characterInfo.setPadding(new Insets(10));</span>
<span class="nc" id="L388">            characterInfo.setVgap(10);</span>
<span class="nc" id="L389">            HBox hBox = new HBox();</span>
<span class="nc" id="L390">            hBox.setSpacing(10);</span>
<span class="nc" id="L391">            hBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L392">            ImageView imageView = new ImageView();</span>
<span class="nc" id="L393">            imageView.setImage(heartImage);</span>
<span class="nc" id="L394">            healthPointText = new Label();</span>
<span class="nc" id="L395">            healthPointText.setFont(Font.font(&quot;Microsoft YaHei&quot;,FontWeight.BOLD,16));</span>
<span class="nc" id="L396">            healthPointText.setTextFill(new Color(0.9,0,0,1));</span>
<span class="nc" id="L397">            hBox.getChildren().addAll(imageView,healthPointText);</span>
<span class="nc" id="L398">            characterInfo.add(hBox, 0,0);</span>
<span class="nc" id="L399">            hBox = new HBox();</span>
<span class="nc" id="L400">            hBox.setSpacing(10);</span>
<span class="nc" id="L401">            hBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L402">            imageView = new ImageView();</span>
<span class="nc" id="L403">            imageView.setImage(goldPileslImage);</span>
<span class="nc" id="L404">            goldText = new Label();</span>
<span class="nc" id="L405">            goldText.setFont(Font.font(&quot;Microsoft YaHei&quot;,FontWeight.BOLD,16));</span>
<span class="nc" id="L406">            goldText.setTextFill(new Color(0,0.9,0,1));</span>
<span class="nc" id="L407">            hBox.getChildren().addAll(imageView,goldText);</span>
<span class="nc" id="L408">            characterInfo.add(hBox, 0,1);</span>
<span class="nc" id="L409">            hBox = new HBox();</span>
<span class="nc" id="L410">            hBox.setSpacing(10);</span>
<span class="nc" id="L411">            hBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L412">            Label label = new Label(&quot;EXP&quot;);</span>
<span class="nc" id="L413">            label.setFont(Font.font(&quot;Microsoft YaHei&quot;,FontWeight.BOLD,16));</span>
<span class="nc" id="L414">            label.setTextFill(new Color(0.64,0.28,0.64,1));</span>
<span class="nc" id="L415">            expText = new Label();</span>
<span class="nc" id="L416">            expText.setFont(Font.font(&quot;Microsoft YaHei&quot;,FontWeight.BOLD,16));</span>
<span class="nc" id="L417">            expText.setTextFill(new Color(0.64,0.28,0.64,1));</span>
<span class="nc" id="L418">            hBox.getChildren().addAll(label,expText);</span>
<span class="nc" id="L419">            characterInfo.add(hBox, 0,2);</span>
        }
<span class="nc" id="L421">        timeline.play();</span>
<span class="nc" id="L422">    }</span>

    public void updateDisplay(){
        // update the dispaly of number of the round
<span class="nc" id="L426">        roundsNumLabel.setText(String.format(&quot;ROUND %d&quot;, world.getRoundsNum()));</span>
<span class="nc" id="L427">        healthPointText.setText(String.format(&quot;%d/100&quot;, world.getCharacter().getHealth()));</span>
<span class="nc" id="L428">        goldText.setText(String.format(&quot;%d&quot;, world.getCharacter().getGold()));</span>
<span class="nc" id="L429">        expText.setText(String.format(&quot;%d&quot;, world.getCharacter().getEXP()));</span>
<span class="nc" id="L430">    }</span>
=======
<span class="nc" id="L329">        System.out.println(&quot;starting timer&quot;);</span>
<span class="nc" id="L330">        isPaused = false;</span>
        
        // trigger adding code to process main game logic to queue. JavaFX will target framerate of 0.3 seconds
<span class="nc bnc" id="L333" title="All 2 branches missed.">        if(timeline == null){</span>
<span class="nc" id="L334">            timeline = new Timeline(new KeyFrame(Duration.seconds(0.3), event -&gt; {</span>
                // check whether the position is in the Hero's Castle
<span class="nc bnc" id="L336" title="All 2 branches missed.">                if(world.getRoundsNum()== 0){</span>
<span class="nc" id="L337">                    world.addRoundsNum();</span>
                }else{
<span class="nc bnc" id="L339" title="All 2 branches missed.">                    if(heroCastleBuilding.work(world.getCharacter(),this)) return;</span>
                }
<span class="nc" id="L341">                world.runTickMoves();</span>

<span class="nc" id="L343">                Item item = world.getLastUnequippedInventoryItem();</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">                if (item != null) {</span>
<span class="nc" id="L345">                    onLoad(item);</span>
                }
<span class="nc" id="L347">                Card card = world.getLastCardEntity();</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">                if (card != null) {</span>
<span class="nc" id="L349">                    onLoad(card);</span>
                }

<span class="nc bnc" id="L352" title="All 2 branches missed.">                if (world.GetUsedTheOneRing()) {</span>
<span class="nc" id="L353">                    setUsedTheOneRingImage();</span>
                }

<span class="nc" id="L356">                List&lt;BasicEnemy&gt; deadEnemies = world.buildingFunction();</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">                for (BasicEnemy e: deadEnemies){</span>
<span class="nc" id="L358">                    reactToEnemyDefeat(e);</span>
<span class="nc" id="L359">                }</span>

<span class="nc" id="L361">                List&lt;BasicEnemy&gt; defeatedEnemies = world.runBattles();</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">                for (BasicEnemy e: defeatedEnemies){</span>
<span class="nc" id="L363">                    reactToEnemyDefeat(e);</span>
<span class="nc" id="L364">                }</span>
<span class="nc" id="L365">                List&lt;BasicEnemy&gt; newEnemies = world.possiblySpawnEnemies();</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">                for (BasicEnemy newEnemy: newEnemies){</span>
<span class="nc" id="L367">                    onLoad(newEnemy);</span>
<span class="nc" id="L368">                }</span>
                // update the display
<span class="nc" id="L370">                updateDisplay();</span>
<span class="nc" id="L371">                printThreadingNotes(&quot;HANDLED TIMER&quot;);</span>
<span class="nc" id="L372">            }));</span>
<span class="nc" id="L373">            timeline.setCycleCount(Animation.INDEFINITE);</span>
 
            // build up the hero castle building
<span class="nc" id="L376">            heroCastleBuilding = new HeroCastleBuilding(new SimpleIntegerProperty(0), </span>
             new SimpleIntegerProperty(0), this);
<span class="nc" id="L378">            addHeroCastle(heroCastleBuilding);</span>

            // build up the card descripton
<span class="nc" id="L381">            cardDescription = new CardDescription(this);</span>

<span class="nc" id="L383">            roundsNumLabel.setPadding(new Insets(0,0,0,10));</span>
            // init the display of heath point, gold and exp
<span class="nc" id="L385">            characterInfo.getChildren().clear();</span>
<span class="nc" id="L386">            characterInfo.setPadding(new Insets(10));</span>
<span class="nc" id="L387">            characterInfo.setVgap(10);</span>
<span class="nc" id="L388">            HBox hBox = new HBox();</span>
<span class="nc" id="L389">            hBox.setSpacing(10);</span>
<span class="nc" id="L390">            hBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L391">            ImageView imageView = new ImageView();</span>
<span class="nc" id="L392">            imageView.setImage(heartImage);</span>
<span class="nc" id="L393">            healthPointText = new Label();</span>
<span class="nc" id="L394">            healthPointText.setFont(Font.font(&quot;Microsoft YaHei&quot;,FontWeight.BOLD,16));</span>
<span class="nc" id="L395">            healthPointText.setTextFill(new Color(0.9,0,0,1));</span>
<span class="nc" id="L396">            hBox.getChildren().addAll(imageView,healthPointText);</span>
<span class="nc" id="L397">            characterInfo.add(hBox, 0,0);</span>
<span class="nc" id="L398">            hBox = new HBox();</span>
<span class="nc" id="L399">            hBox.setSpacing(10);</span>
<span class="nc" id="L400">            hBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L401">            imageView = new ImageView();</span>
<span class="nc" id="L402">            imageView.setImage(goldPileslImage);</span>
<span class="nc" id="L403">            goldText = new Label();</span>
<span class="nc" id="L404">            goldText.setFont(Font.font(&quot;Microsoft YaHei&quot;,FontWeight.BOLD,16));</span>
<span class="nc" id="L405">            goldText.setTextFill(new Color(0,0.9,0,1));</span>
<span class="nc" id="L406">            hBox.getChildren().addAll(imageView,goldText);</span>
<span class="nc" id="L407">            characterInfo.add(hBox, 0,1);</span>
<span class="nc" id="L408">            hBox = new HBox();</span>
<span class="nc" id="L409">            hBox.setSpacing(10);</span>
<span class="nc" id="L410">            hBox.setAlignment(Pos.CENTER_LEFT);</span>
<span class="nc" id="L411">            Label label = new Label(&quot;EXP&quot;);</span>
<span class="nc" id="L412">            label.setFont(Font.font(&quot;Microsoft YaHei&quot;,FontWeight.BOLD,16));</span>
<span class="nc" id="L413">            label.setTextFill(new Color(0.64,0.28,0.64,1));</span>
<span class="nc" id="L414">            expText = new Label();</span>
<span class="nc" id="L415">            expText.setFont(Font.font(&quot;Microsoft YaHei&quot;,FontWeight.BOLD,16));</span>
<span class="nc" id="L416">            expText.setTextFill(new Color(0.64,0.28,0.64,1));</span>
<span class="nc" id="L417">            hBox.getChildren().addAll(label,expText);</span>
<span class="nc" id="L418">            characterInfo.add(hBox, 0,2);</span>
        }
<span class="nc" id="L420">        timeline.play();</span>
<span class="nc" id="L421">    }</span>

    public void updateDisplay(){
        // update the dispaly of number of the round
<span class="nc" id="L425">        roundsNumLabel.setText(String.format(&quot;ROUND %d&quot;, world.getRoundsNum()));</span>
<span class="nc" id="L426">        healthPointText.setText(String.format(&quot;%d/100&quot;, world.getCharacter().getHealth()));</span>
<span class="nc" id="L427">        goldText.setText(String.format(&quot;%d&quot;, world.getCharacter().getGold()));</span>
<span class="nc" id="L428">        expText.setText(String.format(&quot;%d&quot;, world.getCharacter().getEXP()));</span>
<span class="nc" id="L429">    }</span>
>>>>>>> master

    /**
     * pause the execution of the game loop
     * the human player can still drag and drop items during the game pause
     */
    public void pause(){
<<<<<<< HEAD
<span class="nc" id="L437">        isPaused = true;</span>
<span class="nc" id="L438">        System.out.println(&quot;pausing&quot;);</span>
<span class="nc" id="L439">        timeline.stop();</span>
<span class="nc" id="L440">    }</span>
=======
<span class="nc" id="L436">        isPaused = true;</span>
<span class="nc" id="L437">        System.out.println(&quot;pausing&quot;);</span>
<span class="nc" id="L438">        timeline.stop();</span>
<span class="nc" id="L439">    }</span>
>>>>>>> master

    /**
     *  terminate pause
     */
    public void terminate(){
<<<<<<< HEAD
<span class="nc" id="L446">        pause();</span>
<span class="nc" id="L447">    }</span>
=======
<span class="nc" id="L445">        pause();</span>
<span class="nc" id="L446">    }</span>
>>>>>>> master

    /**
     * pair the entity an view so that the view copies the movements of the entity.
     * add view to list of entity images
     * @param entity backend entity to be paired with view
     * @param view frontend imageview to be paired with backend entity
     */
    private void addEntity(Entity entity, ImageView view) {
<<<<<<< HEAD
<span class="nc" id="L456">        trackPosition(entity, view);</span>
<span class="nc" id="L457">        entityImages.add(view);</span>
<span class="nc" id="L458">    }</span>
=======
<span class="nc" id="L455">        trackPosition(entity, view);</span>
<span class="nc" id="L456">        entityImages.add(view);</span>
<span class="nc" id="L457">    }</span>
>>>>>>> master
    
    /**
     * load a card from the world by name, and pair it with an image in the GUI
     */
    private void loadCardByType(CARDS_TYPE cards_TYPE) {
        // DONE = load more types of card
<<<<<<< HEAD
<span class="nc" id="L465">        Card card = world.loadCard(cards_TYPE);</span>
<span class="nc" id="L466">        onLoad(card);</span>
<span class="nc" id="L467">    }</span>
=======
<span class="nc" id="L464">        Card card = world.loadCard(cards_TYPE);</span>
<span class="nc" id="L465">        onLoad(card);</span>
<span class="nc" id="L466">    }</span>
>>>>>>> master

    /**
     * load a item from the world, and pair it with an image in the GUI
     */
    public void loadItemByType(ITEMS_TYPE itemType) {
        // start by getting first available coordinates
<<<<<<< HEAD
<span class="nc" id="L474">        Item item = world.addUnequippedItem(itemType);</span>
<span class="nc" id="L475">        onLoad(item);</span>
<span class="nc" id="L476">    }</span>
=======
<span class="nc" id="L473">        Item item = world.addUnequippedItem(itemType);</span>
<span class="nc" id="L474">        onLoad(item);</span>
<span class="nc" id="L475">    }</span>
>>>>>>> master


    /**
     * run GUI events after an enemy is defeated, such as spawning items/experience/gold
     * @param enemy defeated enemy for which we should react to the death of
     */
    private void reactToEnemyDefeat(BasicEnemy enemy){
        // react to character defeating an enemy
        // in starter code, spawning extra card/weapon...
        // provide different benefits to defeating the enemy based on the type of enemy

        // a type of card is looted from the enemies with a specified probability
<<<<<<< HEAD
<span class="nc" id="L489">        int index = new Random().nextInt(100);</span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">        if(index &lt; 42){</span>
<span class="nc" id="L491">            index = index / 6;</span>
<span class="nc" id="L492">            loadCardByType(CARDS_TYPE.values()[index]);</span>
        }

<span class="nc" id="L495">        int rd = new Random().nextInt(100);</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">        if (rd &lt; 20) {</span>
<span class="nc" id="L497">            loadItemByType(ITEMS_TYPE.SWORD);    </span>
<span class="nc bnc" id="L498" title="All 4 branches missed.">        } else if (rd &gt;= 20 &amp;&amp; rd &lt; 35) {</span>
<span class="nc" id="L499">            loadItemByType(ITEMS_TYPE.STAKE);  </span>
<span class="nc bnc" id="L500" title="All 4 branches missed.">        } else if (rd &gt;= 35 &amp;&amp; rd &lt; 45) {</span>
<span class="nc" id="L501">            loadItemByType(ITEMS_TYPE.STAFF);  </span>
<span class="nc bnc" id="L502" title="All 4 branches missed.">        } else if (rd &gt;= 45 &amp;&amp; rd &lt; 55) {</span>
<span class="nc" id="L503">            loadItemByType(ITEMS_TYPE.ARMOUR);  </span>
<span class="nc bnc" id="L504" title="All 4 branches missed.">        } else if (rd &gt;= 55 &amp;&amp; rd &lt; 70) {</span>
<span class="nc" id="L505">            loadItemByType(ITEMS_TYPE.SHIELD);  </span>
<span class="nc bnc" id="L506" title="All 4 branches missed.">        } else if (rd &gt;= 70 &amp;&amp; rd &lt; 85) {</span>
<span class="nc" id="L507">            loadItemByType(ITEMS_TYPE.HELMET);  </span>
<span class="nc bnc" id="L508" title="All 4 branches missed.">        } else if (rd &gt;= 85 &amp;&amp; rd &lt; 90) {</span>
<span class="nc" id="L509">            loadItemByType(ITEMS_TYPE.THEONERING);  </span>
<span class="nc bnc" id="L510" title="All 4 branches missed.">        } else if (rd &gt;= 90 &amp;&amp; rd &lt;= 100) {</span>
<span class="nc" id="L511">            world.getCharacter().setHealth(world.getCharacter().getHealth() + 50); // health potion</span>
        }
<span class="nc" id="L513">        world.getCharacter().setGold(world.getCharacter().getGold() + enemy.getGoldDefeated());</span>
<span class="nc" id="L514">        world.getCharacter().setEXP(world.getCharacter().getEXP() + enemy.getEXP());</span>
<span class="nc" id="L515">    }</span>
=======
<span class="nc" id="L488">        int index = new Random().nextInt(100);</span>
<span class="nc bnc" id="L489" title="All 2 branches missed.">        if(index &lt; 42){</span>
<span class="nc" id="L490">            index = index / 6;</span>
<span class="nc" id="L491">            loadCardByType(CARDS_TYPE.values()[index]);</span>
        }

<span class="nc" id="L494">        int rd = new Random().nextInt(100);</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">        if (rd &lt; 20) {</span>
<span class="nc" id="L496">            loadItemByType(ITEMS_TYPE.SWORD);    </span>
<span class="nc bnc" id="L497" title="All 4 branches missed.">        } else if (rd &gt;= 20 &amp;&amp; rd &lt; 35) {</span>
<span class="nc" id="L498">            loadItemByType(ITEMS_TYPE.STAKE);  </span>
<span class="nc bnc" id="L499" title="All 4 branches missed.">        } else if (rd &gt;= 35 &amp;&amp; rd &lt; 45) {</span>
<span class="nc" id="L500">            loadItemByType(ITEMS_TYPE.STAFF);  </span>
<span class="nc bnc" id="L501" title="All 4 branches missed.">        } else if (rd &gt;= 45 &amp;&amp; rd &lt; 55) {</span>
<span class="nc" id="L502">            loadItemByType(ITEMS_TYPE.ARMOUR);  </span>
<span class="nc bnc" id="L503" title="All 4 branches missed.">        } else if (rd &gt;= 55 &amp;&amp; rd &lt; 70) {</span>
<span class="nc" id="L504">            loadItemByType(ITEMS_TYPE.SHIELD);  </span>
<span class="nc bnc" id="L505" title="All 4 branches missed.">        } else if (rd &gt;= 70 &amp;&amp; rd &lt; 85) {</span>
<span class="nc" id="L506">            loadItemByType(ITEMS_TYPE.HELMET);  </span>
<span class="nc bnc" id="L507" title="All 4 branches missed.">        } else if (rd &gt;= 85 &amp;&amp; rd &lt; 90) {</span>
<span class="nc" id="L508">            loadItemByType(ITEMS_TYPE.THEONERING);  </span>
<span class="nc bnc" id="L509" title="All 4 branches missed.">        } else if (rd &gt;= 90 &amp;&amp; rd &lt;= 100) {</span>
<span class="nc" id="L510">            world.getCharacter().setHealth(world.getCharacter().getHealth() + 50); // health potion</span>
        }
<span class="nc" id="L512">        world.getCharacter().setGold(world.getCharacter().getGold() + enemy.getGoldDefeated());</span>
<span class="nc" id="L513">        world.getCharacter().setEXP(world.getCharacter().getEXP() + enemy.getEXP());</span>
<span class="nc" id="L514">    }</span>
>>>>>>> master

    /**
     * load a card into the GUI.
     * Particularly, we must connect to the drag detection event handler,
     * and load the image into the cards GridPane.
     * @param vampireCastleCard
     */
    private void onLoad(Card card) {
<<<<<<< HEAD
<span class="nc" id="L524">        ImageView view = null;</span>
<span class="nc bnc" id="L525" title="All 2 branches missed.">        if(card instanceof TowerCard){</span>
<span class="nc" id="L526">            view = new ImageView(towerCardImage);</span>
        }
<span class="nc bnc" id="L528" title="All 2 branches missed.">        else if(card instanceof ZombiePitCard){</span>
<span class="nc" id="L529">            view = new ImageView(zombiePitCardImage);</span>
        }
<span class="nc bnc" id="L531" title="All 2 branches missed.">        else if(card instanceof VampireCastleCard){</span>
<span class="nc" id="L532">            view = new ImageView(vampireCastleCardImage);</span>
        }
<span class="nc bnc" id="L534" title="All 2 branches missed.">        else if(card instanceof BarrackCard){</span>
<span class="nc" id="L535">            view = new ImageView(barrackCardImage);</span>
        }
<span class="nc bnc" id="L537" title="All 2 branches missed.">        else if(card instanceof VillageCard){</span>
<span class="nc" id="L538">            view = new ImageView(villageCardImage);</span>
        }
<span class="nc bnc" id="L540" title="All 2 branches missed.">        else if(card instanceof TrapCard){</span>
<span class="nc" id="L541">            view = new ImageView(trapCardImage);</span>
        }
<span class="nc bnc" id="L543" title="All 2 branches missed.">        else if(card instanceof CampfireCard){</span>
<span class="nc" id="L544">            view = new ImageView(campfireCardImage);</span>
=======
<span class="nc" id="L523">        ImageView view = null;</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">        if(card instanceof TowerCard){</span>
<span class="nc" id="L525">            view = new ImageView(towerCardImage);</span>
        }
<span class="nc bnc" id="L527" title="All 2 branches missed.">        else if(card instanceof ZombiePitCard){</span>
<span class="nc" id="L528">            view = new ImageView(zombiePitCardImage);</span>
        }
<span class="nc bnc" id="L530" title="All 2 branches missed.">        else if(card instanceof VampireCastleCard){</span>
<span class="nc" id="L531">            view = new ImageView(vampireCastleCardImage);</span>
        }
<span class="nc bnc" id="L533" title="All 2 branches missed.">        else if(card instanceof BarrackCard){</span>
<span class="nc" id="L534">            view = new ImageView(barrackCardImage);</span>
        }
<span class="nc bnc" id="L536" title="All 2 branches missed.">        else if(card instanceof VillageCard){</span>
<span class="nc" id="L537">            view = new ImageView(villageCardImage);</span>
        }
<span class="nc bnc" id="L539" title="All 2 branches missed.">        else if(card instanceof TrapCard){</span>
<span class="nc" id="L540">            view = new ImageView(trapCardImage);</span>
        }
<span class="nc bnc" id="L542" title="All 2 branches missed.">        else if(card instanceof CampfireCard){</span>
<span class="nc" id="L543">            view = new ImageView(campfireCardImage);</span>
>>>>>>> master
        }

        // FROM https://stackoverflow.com/questions/41088095/javafx-drag-and-drop-to-gridpane
        // note target setOnDragOver and setOnDragEntered defined in initialize method
<<<<<<< HEAD
<span class="nc" id="L549">        addDragEventHandlers(view, DRAGGABLE_TYPE.CARD, cards, squares);</span>

<span class="nc" id="L551">        addEntity(card, view);</span>
<span class="nc" id="L552">        cards.getChildren().add(view);</span>
<span class="nc" id="L553">        view.setOnMouseEntered(new CardMouseHoverHandler(card.getName(),card.getDescription()));</span>
<span class="nc" id="L554">        view.setOnMouseExited(new CardMouseLeaveHandler());</span>
<span class="nc" id="L555">    }</span>
=======
<span class="nc" id="L548">        addDragEventHandlers(view, DRAGGABLE_TYPE.CARD, cards, squares);</span>

<span class="nc" id="L550">        addEntity(card, view);</span>
<span class="nc" id="L551">        cards.getChildren().add(view);</span>
<span class="nc" id="L552">        view.setOnMouseEntered(new CardMouseHoverHandler(card.getName(),card.getDescription()));</span>
<span class="nc" id="L553">        view.setOnMouseExited(new CardMouseLeaveHandler());</span>
<span class="nc" id="L554">    }</span>
>>>>>>> master

    /**
     * load a item into the GUI.
     * Particularly, we must connect to the drag detection event handler,
     * and load the image into the unequippedInventory GridPane.
     * @param item
     */
    private void onLoad(Item item) {
<<<<<<< HEAD
<span class="nc" id="L564">        ImageView view = null;</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">        if (item instanceof Sword) {</span>
<span class="nc" id="L566">            view = new ImageView(swordImage);</span>
<span class="nc bnc" id="L567" title="All 2 branches missed.">        } else if (item instanceof Stake) {</span>
<span class="nc" id="L568">            view = new ImageView(stakeImage);</span>
<span class="nc bnc" id="L569" title="All 2 branches missed.">        } else if (item instanceof Staff) {</span>
<span class="nc" id="L570">            view = new ImageView(staffImage);</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">        } else if (item instanceof Armour) {</span>
<span class="nc" id="L572">            view = new ImageView(armourImage);</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">        } else if (item instanceof Shield) {</span>
<span class="nc" id="L574">            view = new ImageView(shieldImage);</span>
<span class="nc bnc" id="L575" title="All 2 branches missed.">        } else if (item instanceof Helmet) {</span>
<span class="nc" id="L576">            view = new ImageView(helmetImage);</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">        } else if (item instanceof TheOneRing) {</span>
<span class="nc" id="L578">            view = new ImageView(theOneRingImage);</span>
        }

<span class="nc" id="L581">        addDragEventHandlers(view, DRAGGABLE_TYPE.ITEM, unequippedInventory, equippedItems);</span>
<span class="nc" id="L582">        addEntity(item, view);</span>
<span class="nc" id="L583">        unequippedInventory.getChildren().add(view);</span>
<span class="nc" id="L584">    }</span>
=======
<span class="nc" id="L563">        ImageView view = null;</span>
<span class="nc bnc" id="L564" title="All 2 branches missed.">        if (item instanceof Sword) {</span>
<span class="nc" id="L565">            view = new ImageView(swordImage);</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">        } else if (item instanceof Stake) {</span>
<span class="nc" id="L567">            view = new ImageView(stakeImage);</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">        } else if (item instanceof Staff) {</span>
<span class="nc" id="L569">            view = new ImageView(staffImage);</span>
<span class="nc bnc" id="L570" title="All 2 branches missed.">        } else if (item instanceof Armour) {</span>
<span class="nc" id="L571">            view = new ImageView(armourImage);</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">        } else if (item instanceof Shield) {</span>
<span class="nc" id="L573">            view = new ImageView(shieldImage);</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">        } else if (item instanceof Helmet) {</span>
<span class="nc" id="L575">            view = new ImageView(helmetImage);</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">        } else if (item instanceof TheOneRing) {</span>
<span class="nc" id="L577">            view = new ImageView(theOneRingImage);</span>
        }

<span class="nc" id="L580">        addDragEventHandlers(view, DRAGGABLE_TYPE.ITEM, unequippedInventory, equippedItems);</span>
<span class="nc" id="L581">        addEntity(item, view);</span>
<span class="nc" id="L582">        unequippedInventory.getChildren().add(view);</span>
<span class="nc" id="L583">    }</span>
>>>>>>> master

    /**
     * load an enemy into the GUI
     * @param enemy
     */
    public void onLoad(BasicEnemy enemy) {
<<<<<<< HEAD
<span class="nc" id="L591">        ImageView view = null;</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">        if(enemy instanceof Zombie){</span>
<span class="nc" id="L593">            view = new ImageView(zombieImage);</span>
        }
<span class="nc bnc" id="L595" title="All 2 branches missed.">        else if(enemy instanceof Vampire){</span>
<span class="nc" id="L596">            view = new ImageView(vampireImage);</span>
        }
<span class="nc bnc" id="L598" title="All 2 branches missed.">        else if(enemy instanceof BasicEnemy){</span>
<span class="nc" id="L599">            view = new ImageView(basicEnemyImage);</span>
        }
<span class="nc" id="L601">        addEntity(enemy, view);</span>
<span class="nc" id="L602">        squares.getChildren().add(view);</span>
<span class="nc" id="L603">    }</span>
=======
<span class="nc" id="L590">        ImageView view = null;</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">        if(enemy instanceof Zombie){</span>
<span class="nc" id="L592">            view = new ImageView(zombieImage);</span>
        }
<span class="nc bnc" id="L594" title="All 2 branches missed.">        else if(enemy instanceof Vampire){</span>
<span class="nc" id="L595">            view = new ImageView(vampireImage);</span>
        }
<span class="nc bnc" id="L597" title="All 2 branches missed.">        else if(enemy instanceof BasicEnemy){</span>
<span class="nc" id="L598">            view = new ImageView(basicEnemyImage);</span>
        }
<span class="nc" id="L600">        addEntity(enemy, view);</span>
<span class="nc" id="L601">        squares.getChildren().add(view);</span>
<span class="nc" id="L602">    }</span>
>>>>>>> master

    /**
     * load a hero castle into the GUI
     */
    public void addHeroCastle(Entity heroEntity) {
<<<<<<< HEAD
<span class="nc" id="L609">        ImageView view = new ImageView(heroCastlImage);</span>
<span class="nc" id="L610">        addEntity(heroEntity, view);</span>
<span class="nc" id="L611">        squares.getChildren().add(view);</span>
<span class="nc" id="L612">    }</span>
=======
<span class="nc" id="L608">        ImageView view = new ImageView(heroCastlImage);</span>
<span class="nc" id="L609">        addEntity(heroEntity, view);</span>
<span class="nc" id="L610">        squares.getChildren().add(view);</span>
<span class="nc" id="L611">    }</span>
>>>>>>> master

    /**
     * load a building into the GUI
     * @param building
     */
    private void onLoad(Building building){
<<<<<<< HEAD
<span class="nc" id="L619">        ImageView view = null;</span>
<span class="nc bnc" id="L620" title="All 2 branches missed.">        if(building instanceof TowerBuilding){</span>
<span class="nc" id="L621">            view = new ImageView(towerBuildingImage);</span>
        }
<span class="nc bnc" id="L623" title="All 2 branches missed.">        else if(building instanceof ZombiePitBuilding){</span>
<span class="nc" id="L624">            view = new ImageView(zombiePitBuildingImage);</span>
        }
<span class="nc bnc" id="L626" title="All 2 branches missed.">        else if(building instanceof VampireCastleBuilding){</span>
<span class="nc" id="L627">            view = new ImageView(vampireCastleBuildingImage);</span>
        }
<span class="nc bnc" id="L629" title="All 2 branches missed.">        else if(building instanceof BarrackBuilding){</span>
<span class="nc" id="L630">            view = new ImageView(barrackBuildingImage);</span>
        }
<span class="nc bnc" id="L632" title="All 2 branches missed.">        else if(building instanceof VillageBuilding){</span>
<span class="nc" id="L633">            view = new ImageView(villageBuildingImage);</span>
        }
<span class="nc bnc" id="L635" title="All 2 branches missed.">        else if(building instanceof TrapBuilding){</span>
<span class="nc" id="L636">            view = new ImageView(trapBuildingImage);</span>
        }
<span class="nc bnc" id="L638" title="All 2 branches missed.">        else if(building instanceof CampfireBuilding){</span>
<span class="nc" id="L639">            view = new ImageView(campfireBuildingImage);</span>
        }
<span class="nc" id="L641">        addEntity(building, view);</span>
<span class="nc" id="L642">        squares.getChildren().add(view);</span>
<span class="nc" id="L643">    }</span>
=======
<span class="nc" id="L618">        ImageView view = null;</span>
<span class="nc bnc" id="L619" title="All 2 branches missed.">        if(building instanceof TowerBuilding){</span>
<span class="nc" id="L620">            view = new ImageView(towerBuildingImage);</span>
        }
<span class="nc bnc" id="L622" title="All 2 branches missed.">        else if(building instanceof ZombiePitBuilding){</span>
<span class="nc" id="L623">            view = new ImageView(zombiePitBuildingImage);</span>
        }
<span class="nc bnc" id="L625" title="All 2 branches missed.">        else if(building instanceof VampireCastleBuilding){</span>
<span class="nc" id="L626">            view = new ImageView(vampireCastleBuildingImage);</span>
        }
<span class="nc bnc" id="L628" title="All 2 branches missed.">        else if(building instanceof BarrackBuilding){</span>
<span class="nc" id="L629">            view = new ImageView(barrackBuildingImage);</span>
        }
<span class="nc bnc" id="L631" title="All 2 branches missed.">        else if(building instanceof VillageBuilding){</span>
<span class="nc" id="L632">            view = new ImageView(villageBuildingImage);</span>
        }
<span class="nc bnc" id="L634" title="All 2 branches missed.">        else if(building instanceof TrapBuilding){</span>
<span class="nc" id="L635">            view = new ImageView(trapBuildingImage);</span>
        }
<span class="nc bnc" id="L637" title="All 2 branches missed.">        else if(building instanceof CampfireBuilding){</span>
<span class="nc" id="L638">            view = new ImageView(campfireBuildingImage);</span>
        }
<span class="nc" id="L640">        addEntity(building, view);</span>
<span class="nc" id="L641">        squares.getChildren().add(view);</span>
<span class="nc" id="L642">    }</span>
>>>>>>> master

    /**
     * add drag event handlers for dropping into gridpanes, dragging over the background, dropping over the background.
     * These are not attached to invidual items such as swords/cards.
     * @param draggableType the type being dragged - card or item
     * @param sourceGridPane the gridpane being dragged from
     * @param targetGridPane the gridpane the human player should be dragging to (but we of course cannot guarantee they will do so)
     */
    private void buildNonEntityDragHandlers(DRAGGABLE_TYPE draggableType, GridPane sourceGridPane, GridPane targetGridPane){
        // TODO = be more selective about where something can be dropped
        // for example, in the specification, villages can only be dropped on path, whilst vampire castles cannot go on the path

<<<<<<< HEAD
<span class="nc" id="L656">        gridPaneSetOnDragDropped.put(draggableType, new EventHandler&lt;DragEvent&gt;() {</span>
=======
<span class="nc" id="L655">        gridPaneSetOnDragDropped.put(draggableType, new EventHandler&lt;DragEvent&gt;() {</span>
>>>>>>> master
            public void handle(DragEvent event) {
                // TODO = for being more selective about where something can be dropped, consider applying additional if-statement logic
                /*
                 *you might want to design the application so dropping at an invalid location drops at the most recent valid location hovered over,
                 * or simply allow the card/item to return to its slot (the latter is easier, as you won't have to store the last valid drop location!)
                 */
<<<<<<< HEAD
<span class="nc" id="L663">                boolean isValid = true;  // it means whether the position is valid</span>
<span class="nc bnc" id="L664" title="All 2 branches missed.">                if (currentlyDraggedType == draggableType){</span>
=======
<span class="nc" id="L662">                boolean isValid = true;  // it means whether the position is valid</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">                if (currentlyDraggedType == draggableType){</span>
>>>>>>> master
                    // problem = event is drop completed is false when should be true...
                    // https://bugs.openjdk.java.net/browse/JDK-8117019
                    // putting drop completed at start not making complete on VLAB...

                    //Data dropped
                    //If there is an image on the dragboard, read it and use it
<<<<<<< HEAD
<span class="nc" id="L671">                    Dragboard db = event.getDragboard();</span>
<span class="nc" id="L672">                    Node node = event.getPickResult().getIntersectedNode();</span>
<span class="nc bnc" id="L673" title="All 4 branches missed.">                    if(node != targetGridPane &amp;&amp; db.hasImage()){</span>

<span class="nc" id="L675">                        Integer cIndex = GridPane.getColumnIndex(node);</span>
<span class="nc" id="L676">                        Integer rIndex = GridPane.getRowIndex(node);</span>
<span class="nc bnc" id="L677" title="All 2 branches missed.">                        int x = cIndex == null ? 0 : cIndex;</span>
<span class="nc bnc" id="L678" title="All 2 branches missed.">                        int y = rIndex == null ? 0 : rIndex;</span>
                        //Places at 0,0 - will need to take coordinates once that is implemented
<span class="nc" id="L680">                        ImageView image = new ImageView(db.getImage());</span>

<span class="nc" id="L682">                        int nodeX = GridPane.getColumnIndex(currentlyDraggedImage);</span>
<span class="nc" id="L683">                        int nodeY = GridPane.getRowIndex(currentlyDraggedImage);</span>

<span class="nc bnc" id="L685" title="All 3 branches missed.">                        switch (draggableType){</span>
                            case CARD:
                                // check whether the position is valid
<span class="nc bnc" id="L688" title="All 2 branches missed.">                                if(currentlyDraggedImage.getImage() == towerCardImage ||</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">                                currentlyDraggedImage.getImage() == zombiePitCardImage ||</span>
<span class="nc bnc" id="L690" title="All 2 branches missed.">                                currentlyDraggedImage.getImage() == vampireCastleCardImage ||</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">                                currentlyDraggedImage.getImage() == campfireCardImage){</span>
<span class="nc bnc" id="L692" title="All 2 branches missed.">                                    if(!world.checkAdjacentPath(x, y)){</span>
<span class="nc" id="L693">                                        isValid = false;</span>
                                    }
                                }
                                else{
<span class="nc bnc" id="L697" title="All 2 branches missed.">                                    if(!world.checkInPath(x, y)){</span>
<span class="nc" id="L698">                                        isValid = false;</span>
                                    }
                                }
                                
<span class="nc bnc" id="L702" title="All 2 branches missed.">                                if(isValid){</span>
<span class="nc" id="L703">                                    removeDraggableDragEventHandlers(draggableType, targetGridPane);</span>
                                    // DONE = spawn a building here of different types
<span class="nc" id="L705">                                    Building newBuilding = convertCardToBuildingByCoordinates(nodeX, nodeY, x, y);</span>
<span class="nc" id="L706">                                    onLoad(newBuilding);</span>
<span class="nc" id="L707">                                }else{</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">                                    for (Node mNode: targetGridPane.getChildren()){</span>
<span class="nc bnc" id="L709" title="All 2 branches missed.">                                        if(mNode.getOpacity() &lt; 1){</span>
<span class="nc" id="L710">                                            mNode.setOpacity(1);</span>
                                        }
<span class="nc" id="L712">                                    }</span>
                                }
<span class="nc" id="L714">                                break;</span>
                            case ITEM:
<span class="nc" id="L716">                                removeDraggableDragEventHandlers(draggableType, targetGridPane);</span>
                                // spawn an item in the new location. 
<span class="nc" id="L718">                                Item currentItem = world.GetEquippedFromUnequippedByCoordinates(nodeX, nodeY, x, y);</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">                                if (currentItem != null) {</span>
<span class="nc" id="L720">                                    targetGridPane.add(image, x, y, 1, 1);</span>
<span class="nc" id="L721">                                    world.setCharacterEquipment(world.getCharacter(), currentItem);</span>
                                } else {
<span class="nc bnc" id="L723" title="All 2 branches missed.">                                    for (Node mNode: targetGridPane.getChildren()){</span>
<span class="nc bnc" id="L724" title="All 2 branches missed.">                                        if(mNode.getOpacity() &lt; 1){</span>
<span class="nc" id="L725">                                            mNode.setOpacity(1);</span>
                                        }
<span class="nc" id="L727">                                    }</span>
<span class="nc" id="L728">                                    sourceGridPane.add(image, nodeX, nodeY);</span>
<span class="nc" id="L729">                                    addDragEventHandlers(image, DRAGGABLE_TYPE.ITEM, unequippedInventory, equippedItems);</span>
                                }
<span class="nc" id="L731">                                break;</span>
=======
<span class="nc" id="L670">                    Dragboard db = event.getDragboard();</span>
<span class="nc" id="L671">                    Node node = event.getPickResult().getIntersectedNode();</span>
<span class="nc bnc" id="L672" title="All 4 branches missed.">                    if(node != targetGridPane &amp;&amp; db.hasImage()){</span>

<span class="nc" id="L674">                        Integer cIndex = GridPane.getColumnIndex(node);</span>
<span class="nc" id="L675">                        Integer rIndex = GridPane.getRowIndex(node);</span>
<span class="nc bnc" id="L676" title="All 2 branches missed.">                        int x = cIndex == null ? 0 : cIndex;</span>
<span class="nc bnc" id="L677" title="All 2 branches missed.">                        int y = rIndex == null ? 0 : rIndex;</span>
                        //Places at 0,0 - will need to take coordinates once that is implemented
<span class="nc" id="L679">                        ImageView image = new ImageView(db.getImage());</span>

<span class="nc" id="L681">                        int nodeX = GridPane.getColumnIndex(currentlyDraggedImage);</span>
<span class="nc" id="L682">                        int nodeY = GridPane.getRowIndex(currentlyDraggedImage);</span>

<span class="nc bnc" id="L684" title="All 3 branches missed.">                        switch (draggableType){</span>
                            case CARD:
                                // check whether the position is valid
<span class="nc bnc" id="L687" title="All 2 branches missed.">                                if(currentlyDraggedImage.getImage() == towerCardImage ||</span>
<span class="nc bnc" id="L688" title="All 2 branches missed.">                                currentlyDraggedImage.getImage() == zombiePitCardImage ||</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">                                currentlyDraggedImage.getImage() == vampireCastleCardImage ||</span>
<span class="nc bnc" id="L690" title="All 2 branches missed.">                                currentlyDraggedImage.getImage() == campfireCardImage){</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">                                    if(!world.checkAdjacentPath(x, y)){</span>
<span class="nc" id="L692">                                        isValid = false;</span>
                                    }
                                }
                                else{
<span class="nc bnc" id="L696" title="All 2 branches missed.">                                    if(!world.checkInPath(x, y)){</span>
<span class="nc" id="L697">                                        isValid = false;</span>
                                    }
                                }
                                
<span class="nc bnc" id="L701" title="All 2 branches missed.">                                if(isValid){</span>
<span class="nc" id="L702">                                    removeDraggableDragEventHandlers(draggableType, targetGridPane);</span>
                                    // DONE = spawn a building here of different types
<span class="nc" id="L704">                                    Building newBuilding = convertCardToBuildingByCoordinates(nodeX, nodeY, x, y);</span>
<span class="nc" id="L705">                                    onLoad(newBuilding);</span>
<span class="nc" id="L706">                                }else{</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">                                    for (Node mNode: targetGridPane.getChildren()){</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">                                        if(mNode.getOpacity() &lt; 1){</span>
<span class="nc" id="L709">                                            mNode.setOpacity(1);</span>
                                        }
<span class="nc" id="L711">                                    }</span>
                                }
<span class="nc" id="L713">                                break;</span>
                            case ITEM:
<span class="nc" id="L715">                                removeDraggableDragEventHandlers(draggableType, targetGridPane);</span>
                                // spawn an item in the new location. 
<span class="nc" id="L717">                                Item currentItem = world.GetEquippedFromUnequippedByCoordinates(nodeX, nodeY, x, y);</span>
<span class="nc bnc" id="L718" title="All 2 branches missed.">                                if (currentItem != null) {</span>
<span class="nc" id="L719">                                    targetGridPane.add(image, x, y, 1, 1);</span>
<span class="nc" id="L720">                                    world.setCharacterEquipment(world.getCharacter(), currentItem);</span>
                                } else {
<span class="nc bnc" id="L722" title="All 2 branches missed.">                                    for (Node mNode: targetGridPane.getChildren()){</span>
<span class="nc bnc" id="L723" title="All 2 branches missed.">                                        if(mNode.getOpacity() &lt; 1){</span>
<span class="nc" id="L724">                                            mNode.setOpacity(1);</span>
                                        }
<span class="nc" id="L726">                                    }</span>
<span class="nc" id="L727">                                    sourceGridPane.add(image, nodeX, nodeY);</span>
<span class="nc" id="L728">                                    addDragEventHandlers(image, DRAGGABLE_TYPE.ITEM, unequippedInventory, equippedItems);</span>
                                }
<span class="nc" id="L730">                                break;</span>
>>>>>>> master
                            default:
                                break;
                        }
                        
<<<<<<< HEAD
<span class="nc bnc" id="L736" title="All 2 branches missed.">                        if(isValid){</span>
<span class="nc" id="L737">                            draggedEntity.setVisible(false);</span>
<span class="nc" id="L738">                            draggedEntity.setMouseTransparent(false);</span>
                            // remove drag event handlers before setting currently dragged image to null
<span class="nc" id="L740">                            currentlyDraggedImage = null;</span>
<span class="nc" id="L741">                            currentlyDraggedType = null;</span>
<span class="nc" id="L742">                            printThreadingNotes(&quot;DRAG DROPPED ON GRIDPANE HANDLED&quot;);</span>
                        }
                    }
                }
<span class="nc bnc" id="L746" title="All 2 branches missed.">                if(isValid){</span>
<span class="nc" id="L747">                    event.setDropCompleted(true);</span>
                    // consuming prevents the propagation of the event to the anchorPaneRoot (as a sub-node of anchorPaneRoot, GridPane is prioritized)
                    // https://openjfx.io/javadoc/11/javafx.base/javafx/event/Event.html#consume()
                    // to understand this in full detail, ask your tutor or read https://docs.oracle.com/javase/8/javafx/events-tutorial/processing.htm
<span class="nc" id="L751">                    event.consume();</span>
                }
<span class="nc" id="L753">            }</span>
        });

        // this doesn't fire when we drag over GridPane because in the event handler for dragging over GridPanes, we consume the event
<span class="nc" id="L757">        anchorPaneRootSetOnDragOver.put(draggableType, new EventHandler&lt;DragEvent&gt;(){</span>
            // https://github.com/joelgraff/java_fx_node_link_demo/blob/master/Draggable_Node/DraggableNodeDemo/src/application/RootLayout.java#L110
            @Override
            public void handle(DragEvent event) {
<span class="nc bnc" id="L761" title="All 2 branches missed.">                if (currentlyDraggedType == draggableType){</span>
<span class="nc bnc" id="L762" title="All 4 branches missed.">                    if(event.getGestureSource() != anchorPaneRoot &amp;&amp; event.getDragboard().hasImage()){</span>
<span class="nc" id="L763">                        event.acceptTransferModes(TransferMode.MOVE);</span>
                    }
                }
<span class="nc bnc" id="L766" title="All 2 branches missed.">                if (currentlyDraggedType != null){</span>
<span class="nc" id="L767">                    draggedEntity.relocateToPoint(new Point2D(event.getSceneX(), event.getSceneY()));</span>
                }
<span class="nc" id="L769">                event.consume();</span>
<span class="nc" id="L770">            }</span>
        });

        // this doesn't fire when we drop over GridPane because in the event handler for dropping over GridPanes, we consume the event
<span class="nc" id="L774">        anchorPaneRootSetOnDragDropped.put(draggableType, new EventHandler&lt;DragEvent&gt;() {</span>
            public void handle(DragEvent event) {
<span class="nc bnc" id="L776" title="All 2 branches missed.">                if (currentlyDraggedType == draggableType){</span>
                    //Data dropped
                    //If there is an image on the dragboard, read it and use it
<span class="nc" id="L779">                    Dragboard db = event.getDragboard();</span>
<span class="nc" id="L780">                    Node node = event.getPickResult().getIntersectedNode();</span>
<span class="nc bnc" id="L781" title="All 4 branches missed.">                    if(node != anchorPaneRoot &amp;&amp; db.hasImage()){</span>
                        //Places at 0,0 - will need to take coordinates once that is implemented
<span class="nc" id="L783">                        currentlyDraggedImage.setVisible(true);</span>
<span class="nc" id="L784">                        draggedEntity.setVisible(false);</span>
<span class="nc" id="L785">                        draggedEntity.setMouseTransparent(false);</span>
                        // remove drag event handlers before setting currently dragged image to null
<span class="nc" id="L787">                        removeDraggableDragEventHandlers(draggableType, targetGridPane);</span>
                        
<span class="nc" id="L789">                        currentlyDraggedImage = null;</span>
<span class="nc" id="L790">                        currentlyDraggedType = null;</span>
                    }
                }
                //let the source know whether the image was successfully transferred and used
<span class="nc" id="L794">                event.setDropCompleted(true);</span>
<span class="nc" id="L795">                event.consume();</span>
<span class="nc" id="L796">            }</span>
        });
<span class="nc" id="L798">    }</span>
=======
<span class="nc bnc" id="L735" title="All 2 branches missed.">                        if(isValid){</span>
<span class="nc" id="L736">                            draggedEntity.setVisible(false);</span>
<span class="nc" id="L737">                            draggedEntity.setMouseTransparent(false);</span>
                            // remove drag event handlers before setting currently dragged image to null
<span class="nc" id="L739">                            currentlyDraggedImage = null;</span>
<span class="nc" id="L740">                            currentlyDraggedType = null;</span>
<span class="nc" id="L741">                            printThreadingNotes(&quot;DRAG DROPPED ON GRIDPANE HANDLED&quot;);</span>
                        }
                    }
                }
<span class="nc bnc" id="L745" title="All 2 branches missed.">                if(isValid){</span>
<span class="nc" id="L746">                    event.setDropCompleted(true);</span>
                    // consuming prevents the propagation of the event to the anchorPaneRoot (as a sub-node of anchorPaneRoot, GridPane is prioritized)
                    // https://openjfx.io/javadoc/11/javafx.base/javafx/event/Event.html#consume()
                    // to understand this in full detail, ask your tutor or read https://docs.oracle.com/javase/8/javafx/events-tutorial/processing.htm
<span class="nc" id="L750">                    event.consume();</span>
                }
<span class="nc" id="L752">            }</span>
        });

        // this doesn't fire when we drag over GridPane because in the event handler for dragging over GridPanes, we consume the event
<span class="nc" id="L756">        anchorPaneRootSetOnDragOver.put(draggableType, new EventHandler&lt;DragEvent&gt;(){</span>
            // https://github.com/joelgraff/java_fx_node_link_demo/blob/master/Draggable_Node/DraggableNodeDemo/src/application/RootLayout.java#L110
            @Override
            public void handle(DragEvent event) {
<span class="nc bnc" id="L760" title="All 2 branches missed.">                if (currentlyDraggedType == draggableType){</span>
<span class="nc bnc" id="L761" title="All 4 branches missed.">                    if(event.getGestureSource() != anchorPaneRoot &amp;&amp; event.getDragboard().hasImage()){</span>
<span class="nc" id="L762">                        event.acceptTransferModes(TransferMode.MOVE);</span>
                    }
                }
<span class="nc bnc" id="L765" title="All 2 branches missed.">                if (currentlyDraggedType != null){</span>
<span class="nc" id="L766">                    draggedEntity.relocateToPoint(new Point2D(event.getSceneX(), event.getSceneY()));</span>
                }
<span class="nc" id="L768">                event.consume();</span>
<span class="nc" id="L769">            }</span>
        });

        // this doesn't fire when we drop over GridPane because in the event handler for dropping over GridPanes, we consume the event
<span class="nc" id="L773">        anchorPaneRootSetOnDragDropped.put(draggableType, new EventHandler&lt;DragEvent&gt;() {</span>
            public void handle(DragEvent event) {
<span class="nc bnc" id="L775" title="All 2 branches missed.">                if (currentlyDraggedType == draggableType){</span>
                    //Data dropped
                    //If there is an image on the dragboard, read it and use it
<span class="nc" id="L778">                    Dragboard db = event.getDragboard();</span>
<span class="nc" id="L779">                    Node node = event.getPickResult().getIntersectedNode();</span>
<span class="nc bnc" id="L780" title="All 4 branches missed.">                    if(node != anchorPaneRoot &amp;&amp; db.hasImage()){</span>
                        //Places at 0,0 - will need to take coordinates once that is implemented
<span class="nc" id="L782">                        currentlyDraggedImage.setVisible(true);</span>
<span class="nc" id="L783">                        draggedEntity.setVisible(false);</span>
<span class="nc" id="L784">                        draggedEntity.setMouseTransparent(false);</span>
                        // remove drag event handlers before setting currently dragged image to null
<span class="nc" id="L786">                        removeDraggableDragEventHandlers(draggableType, targetGridPane);</span>
                        
<span class="nc" id="L788">                        currentlyDraggedImage = null;</span>
<span class="nc" id="L789">                        currentlyDraggedType = null;</span>
                    }
                }
                //let the source know whether the image was successfully transferred and used
<span class="nc" id="L793">                event.setDropCompleted(true);</span>
<span class="nc" id="L794">                event.consume();</span>
<span class="nc" id="L795">            }</span>
        });
<span class="nc" id="L797">    }</span>
>>>>>>> master

    /**
     * remove the card from the world, and spawn and return a building instead where the card was dropped
     * @param cardNodeX the x coordinate of the card which was dragged, from 0 to width-1
     * @param cardNodeY the y coordinate of the card which was dragged (in starter code this is 0 as only 1 row of cards)
     * @param buildingNodeX the x coordinate of the drop location for the card, where the building will spawn, from 0 to width-1
     * @param buildingNodeY the y coordinate of the drop location for the card, where the building will spawn, from 0 to height-1
     * @return building entity returned from the world
     */
    private Building convertCardToBuildingByCoordinates(int cardNodeX, int cardNodeY, int buildingNodeX, int buildingNodeY) {
<<<<<<< HEAD
<span class="nc" id="L809">        return world.convertCardToBuildingByCoordinates(cardNodeX, cardNodeY, buildingNodeX, buildingNodeY);</span>
=======
<span class="nc" id="L808">        return world.convertCardToBuildingByCoordinates(cardNodeX, cardNodeY, buildingNodeX, buildingNodeY);</span>
>>>>>>> master
    }

    /**
     * remove an item from the unequipped inventory by its x and y coordinates in the unequipped inventory gridpane
     * @param nodeX x coordinate from 0 to unequippedInventoryWidth-1
     * @param nodeY y coordinate from 0 to unequippedInventoryHeight-1
     */
<<<<<<< HEAD
    private void removeItemByCoordinates(int nodeX, int nodeY) {
<span class="nc" id="L818">        world.removeUnequippedInventoryItemByCoordinates(nodeX, nodeY);</span>
<span class="nc" id="L819">    }</span>
=======
    //private void removeItemByCoordinates(int nodeX, int nodeY) {
    //   world.removeUnequippedInventoryItemByCoordinates(nodeX, nodeY);
    //}
>>>>>>> master

    /**
     * add drag event handlers to an ImageView
     * @param view the view to attach drag event handlers to
     * @param draggableType the type of item being dragged - card or item
     * @param sourceGridPane the relevant gridpane from which the entity would be dragged
     * @param targetGridPane the relevant gridpane to which the entity would be dragged to
     */
    private void addDragEventHandlers(ImageView view, DRAGGABLE_TYPE draggableType, GridPane sourceGridPane, GridPane targetGridPane){
<<<<<<< HEAD
<span class="nc" id="L829">        view.setOnDragDetected(new EventHandler&lt;MouseEvent&gt;() {</span>
            public void handle(MouseEvent event) {
<span class="nc" id="L831">                currentlyDraggedImage = view; // set image currently being dragged, so squares setOnDragEntered can detect it...</span>
<span class="nc" id="L832">                currentlyDraggedType = draggableType;</span>
                //Drag was detected, start drap-and-drop gesture
                //Allow any transfer node
<span class="nc" id="L835">                Dragboard db = view.startDragAndDrop(TransferMode.MOVE);</span>
    
                //Put ImageView on dragboard
<span class="nc" id="L838">                ClipboardContent cbContent = new ClipboardContent();</span>
<span class="nc" id="L839">                cbContent.putImage(view.getImage());</span>
<span class="nc" id="L840">                db.setContent(cbContent);</span>
<span class="nc" id="L841">                view.setVisible(false);</span>

<span class="nc" id="L843">                buildNonEntityDragHandlers(draggableType, sourceGridPane, targetGridPane);</span>

<span class="nc" id="L845">                draggedEntity.relocateToPoint(new Point2D(event.getSceneX(), event.getSceneY()));</span>
<span class="nc bnc" id="L846" title="All 3 branches missed.">                switch (draggableType){</span>
                    case CARD:
<span class="nc" id="L848">                        draggedEntity.setImage(view.getImage());</span>
<span class="nc" id="L849">                        break;</span>
                    case ITEM:
<span class="nc" id="L851">                        draggedEntity.setImage(view.getImage());</span>
<span class="nc" id="L852">                        break;</span>
=======
<span class="nc" id="L828">        view.setOnDragDetected(new EventHandler&lt;MouseEvent&gt;() {</span>
            public void handle(MouseEvent event) {
<span class="nc" id="L830">                currentlyDraggedImage = view; // set image currently being dragged, so squares setOnDragEntered can detect it...</span>
<span class="nc" id="L831">                currentlyDraggedType = draggableType;</span>
                //Drag was detected, start drap-and-drop gesture
                //Allow any transfer node
<span class="nc" id="L834">                Dragboard db = view.startDragAndDrop(TransferMode.MOVE);</span>
    
                //Put ImageView on dragboard
<span class="nc" id="L837">                ClipboardContent cbContent = new ClipboardContent();</span>
<span class="nc" id="L838">                cbContent.putImage(view.getImage());</span>
<span class="nc" id="L839">                db.setContent(cbContent);</span>
<span class="nc" id="L840">                view.setVisible(false);</span>

<span class="nc" id="L842">                buildNonEntityDragHandlers(draggableType, sourceGridPane, targetGridPane);</span>

<span class="nc" id="L844">                draggedEntity.relocateToPoint(new Point2D(event.getSceneX(), event.getSceneY()));</span>
<span class="nc bnc" id="L845" title="All 3 branches missed.">                switch (draggableType){</span>
                    case CARD:
<span class="nc" id="L847">                        draggedEntity.setImage(view.getImage());</span>
<span class="nc" id="L848">                        break;</span>
                    case ITEM:
<span class="nc" id="L850">                        draggedEntity.setImage(view.getImage());</span>
<span class="nc" id="L851">                        break;</span>
>>>>>>> master
                    default:
                        break;
                }
                
<<<<<<< HEAD
<span class="nc" id="L857">                draggedEntity.setVisible(true);</span>
<span class="nc" id="L858">                draggedEntity.setMouseTransparent(true);</span>
<span class="nc" id="L859">                draggedEntity.toFront();</span>
=======
<span class="nc" id="L856">                draggedEntity.setVisible(true);</span>
<span class="nc" id="L857">                draggedEntity.setMouseTransparent(true);</span>
<span class="nc" id="L858">                draggedEntity.toFront();</span>
>>>>>>> master

                // IMPORTANT!!!
                // to be able to remove event handlers, need to use addEventHandler
                // https://stackoverflow.com/a/67283792
<<<<<<< HEAD
<span class="nc" id="L864">                targetGridPane.addEventHandler(DragEvent.DRAG_DROPPED, gridPaneSetOnDragDropped.get(draggableType));</span>
<span class="nc" id="L865">                anchorPaneRoot.addEventHandler(DragEvent.DRAG_OVER, anchorPaneRootSetOnDragOver.get(draggableType));</span>
<span class="nc" id="L866">                anchorPaneRoot.addEventHandler(DragEvent.DRAG_DROPPED, anchorPaneRootSetOnDragDropped.get(draggableType));</span>

<span class="nc bnc" id="L868" title="All 2 branches missed.">                for (Node n: targetGridPane.getChildren()){</span>
                    // events for entering and exiting are attached to squares children because that impacts opacity change
                    // these do not affect visibility of original image...
                    // https://stackoverflow.com/questions/41088095/javafx-drag-and-drop-to-gridpane
<span class="nc" id="L872">                    gridPaneNodeSetOnDragEntered.put(draggableType, new EventHandler&lt;DragEvent&gt;() {</span>
                        // TODO = be more selective about whether highlighting changes - if it cannot be dropped in the location, the location shouldn't be highlighted!
                        public void handle(DragEvent event) {
<span class="nc bnc" id="L875" title="All 2 branches missed.">                            if (currentlyDraggedType == draggableType){</span>
                            //The drag-and-drop gesture entered the target
                            //show the user that it is an actual gesture target
<span class="nc bnc" id="L878" title="All 4 branches missed.">                                if(event.getGestureSource() != n &amp;&amp; event.getDragboard().hasImage()){</span>
<span class="nc" id="L879">                                    n.setOpacity(0.7);</span>
                                }
                            }
<span class="nc" id="L882">                            event.consume();</span>
<span class="nc" id="L883">                        }</span>
                    });
<span class="nc" id="L885">                    gridPaneNodeSetOnDragExited.put(draggableType, new EventHandler&lt;DragEvent&gt;() {</span>
                        // TODO = since being more selective about whether highlighting changes, you could program the game so if the new highlight location is invalid the highlighting doesn't change, or leave this as-is
                        public void handle(DragEvent event) {
<span class="nc bnc" id="L888" title="All 2 branches missed.">                            if (currentlyDraggedType == draggableType){</span>
<span class="nc" id="L889">                                n.setOpacity(1);</span>
                            }
                
<span class="nc" id="L892">                            event.consume();</span>
<span class="nc" id="L893">                        }</span>
                    });
<span class="nc" id="L895">                    n.addEventHandler(DragEvent.DRAG_ENTERED, gridPaneNodeSetOnDragEntered.get(draggableType));</span>
<span class="nc" id="L896">                    n.addEventHandler(DragEvent.DRAG_EXITED, gridPaneNodeSetOnDragExited.get(draggableType));</span>
<span class="nc" id="L897">                }</span>
<span class="nc" id="L898">                event.consume();</span>
<span class="nc" id="L899">            }</span>
            
        });
<span class="nc" id="L902">    }</span>
=======
<span class="nc" id="L863">                targetGridPane.addEventHandler(DragEvent.DRAG_DROPPED, gridPaneSetOnDragDropped.get(draggableType));</span>
<span class="nc" id="L864">                anchorPaneRoot.addEventHandler(DragEvent.DRAG_OVER, anchorPaneRootSetOnDragOver.get(draggableType));</span>
<span class="nc" id="L865">                anchorPaneRoot.addEventHandler(DragEvent.DRAG_DROPPED, anchorPaneRootSetOnDragDropped.get(draggableType));</span>

<span class="nc bnc" id="L867" title="All 2 branches missed.">                for (Node n: targetGridPane.getChildren()){</span>
                    // events for entering and exiting are attached to squares children because that impacts opacity change
                    // these do not affect visibility of original image...
                    // https://stackoverflow.com/questions/41088095/javafx-drag-and-drop-to-gridpane
<span class="nc" id="L871">                    gridPaneNodeSetOnDragEntered.put(draggableType, new EventHandler&lt;DragEvent&gt;() {</span>
                        // TODO = be more selective about whether highlighting changes - if it cannot be dropped in the location, the location shouldn't be highlighted!
                        public void handle(DragEvent event) {
<span class="nc bnc" id="L874" title="All 2 branches missed.">                            if (currentlyDraggedType == draggableType){</span>
                            //The drag-and-drop gesture entered the target
                            //show the user that it is an actual gesture target
<span class="nc bnc" id="L877" title="All 4 branches missed.">                                if(event.getGestureSource() != n &amp;&amp; event.getDragboard().hasImage()){</span>
<span class="nc" id="L878">                                    n.setOpacity(0.7);</span>
                                }
                            }
<span class="nc" id="L881">                            event.consume();</span>
<span class="nc" id="L882">                        }</span>
                    });
<span class="nc" id="L884">                    gridPaneNodeSetOnDragExited.put(draggableType, new EventHandler&lt;DragEvent&gt;() {</span>
                        // TODO = since being more selective about whether highlighting changes, you could program the game so if the new highlight location is invalid the highlighting doesn't change, or leave this as-is
                        public void handle(DragEvent event) {
<span class="nc bnc" id="L887" title="All 2 branches missed.">                            if (currentlyDraggedType == draggableType){</span>
<span class="nc" id="L888">                                n.setOpacity(1);</span>
                            }
                
<span class="nc" id="L891">                            event.consume();</span>
<span class="nc" id="L892">                        }</span>
                    });
<span class="nc" id="L894">                    n.addEventHandler(DragEvent.DRAG_ENTERED, gridPaneNodeSetOnDragEntered.get(draggableType));</span>
<span class="nc" id="L895">                    n.addEventHandler(DragEvent.DRAG_EXITED, gridPaneNodeSetOnDragExited.get(draggableType));</span>
<span class="nc" id="L896">                }</span>
<span class="nc" id="L897">                event.consume();</span>
<span class="nc" id="L898">            }</span>
            
        });
<span class="nc" id="L901">    }</span>
>>>>>>> master

    /**
     * remove drag event handlers so that we don't process redundant events
     * this is particularly important for slower machines such as over VLAB.
     * @param draggableType either cards, or items in unequipped inventory
     * @param targetGridPane the gridpane to remove the drag event handlers from
     */
    private void removeDraggableDragEventHandlers(DRAGGABLE_TYPE draggableType, GridPane targetGridPane){
        // remove event handlers from nodes in children squares, from anchorPaneRoot, and squares
<<<<<<< HEAD
<span class="nc" id="L912">        targetGridPane.removeEventHandler(DragEvent.DRAG_DROPPED, gridPaneSetOnDragDropped.get(draggableType));</span>

<span class="nc" id="L914">        anchorPaneRoot.removeEventHandler(DragEvent.DRAG_OVER, anchorPaneRootSetOnDragOver.get(draggableType));</span>
<span class="nc" id="L915">        anchorPaneRoot.removeEventHandler(DragEvent.DRAG_DROPPED, anchorPaneRootSetOnDragDropped.get(draggableType));</span>

<span class="nc bnc" id="L917" title="All 2 branches missed.">        for (Node n: targetGridPane.getChildren()){</span>
<span class="nc" id="L918">            n.removeEventHandler(DragEvent.DRAG_ENTERED, gridPaneNodeSetOnDragEntered.get(draggableType));</span>
<span class="nc" id="L919">            n.removeEventHandler(DragEvent.DRAG_EXITED, gridPaneNodeSetOnDragExited.get(draggableType));</span>
<span class="nc" id="L920">        }</span>
<span class="nc" id="L921">    }</span>
=======
<span class="nc" id="L911">        targetGridPane.removeEventHandler(DragEvent.DRAG_DROPPED, gridPaneSetOnDragDropped.get(draggableType));</span>

<span class="nc" id="L913">        anchorPaneRoot.removeEventHandler(DragEvent.DRAG_OVER, anchorPaneRootSetOnDragOver.get(draggableType));</span>
<span class="nc" id="L914">        anchorPaneRoot.removeEventHandler(DragEvent.DRAG_DROPPED, anchorPaneRootSetOnDragDropped.get(draggableType));</span>

<span class="nc bnc" id="L916" title="All 2 branches missed.">        for (Node n: targetGridPane.getChildren()){</span>
<span class="nc" id="L917">            n.removeEventHandler(DragEvent.DRAG_ENTERED, gridPaneNodeSetOnDragEntered.get(draggableType));</span>
<span class="nc" id="L918">            n.removeEventHandler(DragEvent.DRAG_EXITED, gridPaneNodeSetOnDragExited.get(draggableType));</span>
<span class="nc" id="L919">        }</span>
<span class="nc" id="L920">    }</span>
>>>>>>> master

    /**
     * handle the pressing of keyboard keys.
     * Specifically, we should pause when pressing SPACE
     * @param event some keyboard key press
     */
    @FXML
    public void handleKeyPress(KeyEvent event) {
        // TODO = handle additional key presses, e.g. for consuming a health potion
<<<<<<< HEAD
<span class="nc bnc" id="L931" title="All 2 branches missed.">        switch (event.getCode()) {</span>
        case SPACE:
<span class="nc bnc" id="L933" title="All 2 branches missed.">            if (isPaused){</span>
<span class="nc" id="L934">                startTimer();</span>
            }
            else{
<span class="nc" id="L937">                pause();</span>
            }
<span class="nc" id="L939">            break;</span>
        default:
            break;
        }
<span class="nc" id="L943">    }</span>

    public void setMainMenuSwitcher(MenuSwitcher mainMenuSwitcher){
        // TODO = possibly set other menu switchers
<span class="nc" id="L947">        this.mainMenuSwitcher = mainMenuSwitcher;</span>
<span class="nc" id="L948">    }</span>
=======
<span class="nc bnc" id="L930" title="All 2 branches missed.">        switch (event.getCode()) {</span>
        case SPACE:
<span class="nc bnc" id="L932" title="All 2 branches missed.">            if (isPaused){</span>
<span class="nc" id="L933">                startTimer();</span>
            }
            else{
<span class="nc" id="L936">                pause();</span>
            }
<span class="nc" id="L938">            break;</span>
        default:
            break;
        }
<span class="nc" id="L942">    }</span>

    public void setMainMenuSwitcher(MenuSwitcher mainMenuSwitcher){
        // TODO = possibly set other menu switchers
<span class="nc" id="L946">        this.mainMenuSwitcher = mainMenuSwitcher;</span>
<span class="nc" id="L947">    }</span>
>>>>>>> master

    /**
     * this method is triggered when click button to go to main menu in FXML
     * @throws IOException
     */
    @FXML
    private void switchToMainMenu() throws IOException {
        // TODO = possibly set other menu switchers
<<<<<<< HEAD
<span class="nc" id="L957">        pause();</span>
<span class="nc" id="L958">        heroCastleBuilding.closeStore();</span>
<span class="nc" id="L959">        System.out.print(world.goalCheck());</span>
<span class="nc" id="L960">        mainMenuSwitcher.switchMenu();</span>
<span class="nc" id="L961">    }</span>
=======
<span class="nc" id="L956">        pause();</span>
<span class="nc" id="L957">        heroCastleBuilding.closeStore();</span>
<span class="nc" id="L958">        System.out.print(world.goalCheck());</span>
<span class="nc" id="L959">        mainMenuSwitcher.switchMenu();</span>
<span class="nc" id="L960">    }</span>
>>>>>>> master

    /**
     * Set a node in a GridPane to have its position track the position of an
     * entity in the world.
     *
     * By connecting the model with the view in this way, the model requires no
     * knowledge of the view and changes to the position of entities in the
     * model will automatically be reflected in the view.
     * 
     * note that this is put in the controller rather than the loader because we need to track positions of spawned entities such as enemy
     * or items which might need to be removed should be tracked here
     * 
     * NOTE teardown functions setup here also remove nodes from their GridPane. So it is vital this is handled in this Controller class
     * @param entity
     * @param node
     */
    private void trackPosition(Entity entity, Node node) {
        // TODO = tweak this slightly to remove items from the equipped inventory?
<<<<<<< HEAD
<span class="nc" id="L980">        GridPane.setColumnIndex(node, entity.getX());</span>
<span class="nc" id="L981">        GridPane.setRowIndex(node, entity.getY());</span>

<span class="nc" id="L983">        ChangeListener&lt;Number&gt; xListener = new ChangeListener&lt;Number&gt;() {</span>
            @Override
            public void changed(ObservableValue&lt;? extends Number&gt; observable,
                    Number oldValue, Number newValue) {
<span class="nc" id="L987">                GridPane.setColumnIndex(node, newValue.intValue());</span>
<span class="nc" id="L988">            }</span>
        };
<span class="nc" id="L990">        ChangeListener&lt;Number&gt; yListener = new ChangeListener&lt;Number&gt;() {</span>
            @Override
            public void changed(ObservableValue&lt;? extends Number&gt; observable,
                    Number oldValue, Number newValue) {
<span class="nc" id="L994">                GridPane.setRowIndex(node, newValue.intValue());</span>
<span class="nc" id="L995">            }</span>
        };

        // if need to remove items from the equipped inventory, add code to remove from equipped inventory gridpane in the .onDetach part
<span class="nc" id="L999">        ListenerHandle handleX = ListenerHandles.createFor(entity.x(), node)</span>
<span class="nc" id="L1000">                                               .onAttach((o, l) -&gt; o.addListener(xListener))</span>
<span class="nc" id="L1001">                                               .onDetach((o, l) -&gt; {</span>
<span class="nc" id="L1002">                                                    o.removeListener(xListener);</span>
<span class="nc" id="L1003">                                                    entityImages.remove(node);</span>
<span class="nc" id="L1004">                                                    squares.getChildren().remove(node);</span>
<span class="nc" id="L1005">                                                    cards.getChildren().remove(node);</span>
<span class="nc" id="L1006">                                                    equippedItems.getChildren().remove(node);</span>
<span class="nc" id="L1007">                                                    unequippedInventory.getChildren().remove(node);</span>
<span class="nc" id="L1008">                                                })</span>
<span class="nc" id="L1009">                                               .buildAttached();</span>
<span class="nc" id="L1010">        ListenerHandle handleY = ListenerHandles.createFor(entity.y(), node)</span>
<span class="nc" id="L1011">                                               .onAttach((o, l) -&gt; o.addListener(yListener))</span>
<span class="nc" id="L1012">                                               .onDetach((o, l) -&gt; {</span>
=======
<span class="nc" id="L979">        GridPane.setColumnIndex(node, entity.getX());</span>
<span class="nc" id="L980">        GridPane.setRowIndex(node, entity.getY());</span>

<span class="nc" id="L982">        ChangeListener&lt;Number&gt; xListener = new ChangeListener&lt;Number&gt;() {</span>
            @Override
            public void changed(ObservableValue&lt;? extends Number&gt; observable,
                    Number oldValue, Number newValue) {
<span class="nc" id="L986">                GridPane.setColumnIndex(node, newValue.intValue());</span>
<span class="nc" id="L987">            }</span>
        };
<span class="nc" id="L989">        ChangeListener&lt;Number&gt; yListener = new ChangeListener&lt;Number&gt;() {</span>
            @Override
            public void changed(ObservableValue&lt;? extends Number&gt; observable,
                    Number oldValue, Number newValue) {
<span class="nc" id="L993">                GridPane.setRowIndex(node, newValue.intValue());</span>
<span class="nc" id="L994">            }</span>
        };

        // if need to remove items from the equipped inventory, add code to remove from equipped inventory gridpane in the .onDetach part
<span class="nc" id="L998">        ListenerHandle handleX = ListenerHandles.createFor(entity.x(), node)</span>
<span class="nc" id="L999">                                               .onAttach((o, l) -&gt; o.addListener(xListener))</span>
<span class="nc" id="L1000">                                               .onDetach((o, l) -&gt; {</span>
<span class="nc" id="L1001">                                                    o.removeListener(xListener);</span>
<span class="nc" id="L1002">                                                    entityImages.remove(node);</span>
<span class="nc" id="L1003">                                                    squares.getChildren().remove(node);</span>
<span class="nc" id="L1004">                                                    cards.getChildren().remove(node);</span>
<span class="nc" id="L1005">                                                    equippedItems.getChildren().remove(node);</span>
<span class="nc" id="L1006">                                                    unequippedInventory.getChildren().remove(node);</span>
<span class="nc" id="L1007">                                                })</span>
<span class="nc" id="L1008">                                               .buildAttached();</span>
<span class="nc" id="L1009">        ListenerHandle handleY = ListenerHandles.createFor(entity.y(), node)</span>
<span class="nc" id="L1010">                                               .onAttach((o, l) -&gt; o.addListener(yListener))</span>
<span class="nc" id="L1011">                                               .onDetach((o, l) -&gt; {</span>
>>>>>>> master
                                                   o.removeListener(yListener);
                                                   entityImages.remove(node);
                                                   squares.getChildren().remove(node);
                                                   cards.getChildren().remove(node);
                                                   equippedItems.getChildren().remove(node);
                                                   unequippedInventory.getChildren().remove(node);
                                                })
<<<<<<< HEAD
<span class="nc" id="L1020">                                               .buildAttached();</span>
<span class="nc" id="L1021">        handleX.attach();</span>
<span class="nc" id="L1022">        handleY.attach();</span>

        // this means that if we change boolean property in an entity tracked from here, position will stop being tracked
        // this wont work on character/path entities loaded from loader classes
<span class="nc" id="L1026">        entity.shouldExist().addListener(new ChangeListener&lt;Boolean&gt;(){</span>
            @Override
            public void changed(ObservableValue&lt;? extends Boolean&gt; obervable, Boolean oldValue, Boolean newValue) {
<span class="nc" id="L1029">                handleX.detach();</span>
<span class="nc" id="L1030">                handleY.detach();</span>
<span class="nc" id="L1031">            }</span>
        });
<span class="nc" id="L1033">    }</span>
=======
<span class="nc" id="L1019">                                               .buildAttached();</span>
<span class="nc" id="L1020">        handleX.attach();</span>
<span class="nc" id="L1021">        handleY.attach();</span>

        // this means that if we change boolean property in an entity tracked from here, position will stop being tracked
        // this wont work on character/path entities loaded from loader classes
<span class="nc" id="L1025">        entity.shouldExist().addListener(new ChangeListener&lt;Boolean&gt;(){</span>
            @Override
            public void changed(ObservableValue&lt;? extends Boolean&gt; obervable, Boolean oldValue, Boolean newValue) {
<span class="nc" id="L1028">                handleX.detach();</span>
<span class="nc" id="L1029">                handleY.detach();</span>
<span class="nc" id="L1030">            }</span>
        });
<span class="nc" id="L1032">    }</span>
>>>>>>> master
    
    /**
     * getter of timeline
     * @return timeline
     */
    public Timeline getTimeLine(){
<<<<<<< HEAD
<span class="nc" id="L1040">        return timeline;</span>
=======
<span class="nc" id="L1039">        return timeline;</span>
>>>>>>> master
    }

    /**
     * getter of loopmaniaword
     * @return loopmaniaword
     */
    public LoopManiaWorld getLoopManiaWorld(){
<<<<<<< HEAD
<span class="nc" id="L1048">        return world;</span>
=======
<span class="nc" id="L1047">        return world;</span>
>>>>>>> master
    }
    
    /**
     * eventhandler used to respond to view the description of the card
     */
    private  class CardMouseHoverHandler implements EventHandler&lt;MouseEvent&gt;{
        private String name;
        private String description;
<<<<<<< HEAD
<span class="nc" id="L1057">        public CardMouseHoverHandler(String name, String description){</span>
<span class="nc" id="L1058">            this.name = name;</span>
<span class="nc" id="L1059">            this.description = description;</span>
<span class="nc" id="L1060">        }</span>
        @Override
        public void handle(MouseEvent e) {
<span class="nc" id="L1063">            cardDescription.show(name, description);</span>
<span class="nc" id="L1064">        } </span>
=======
<span class="nc" id="L1056">        public CardMouseHoverHandler(String name, String description){</span>
<span class="nc" id="L1057">            this.name = name;</span>
<span class="nc" id="L1058">            this.description = description;</span>
<span class="nc" id="L1059">        }</span>
        @Override
        public void handle(MouseEvent e) {
<span class="nc" id="L1062">            cardDescription.show(name, description);</span>
<span class="nc" id="L1063">        } </span>
>>>>>>> master
    }

    /**
     * eventhandler used to respond to close the description of the card
     */
<<<<<<< HEAD
<span class="nc" id="L1070">    private  class CardMouseLeaveHandler implements EventHandler&lt;MouseEvent&gt;{</span>
        @Override
        public void handle(MouseEvent e) {
<span class="nc" id="L1073">            cardDescription.close();</span>
<span class="nc" id="L1074">        }</span>
=======
<span class="nc" id="L1069">    private  class CardMouseLeaveHandler implements EventHandler&lt;MouseEvent&gt;{</span>
        @Override
        public void handle(MouseEvent e) {
<span class="nc" id="L1072">            cardDescription.close();</span>
<span class="nc" id="L1073">        }</span>
>>>>>>> master
        
    }


    /**
     * set primary stage
     * @param primaryStage
     */
    public void setPrimaryStage(Stage stage){
<<<<<<< HEAD
<span class="nc" id="L1084">        primaryStage = stage;</span>
<span class="nc" id="L1085">    }</span>
=======
<span class="nc" id="L1083">        primaryStage = stage;</span>
<span class="nc" id="L1084">    }</span>
>>>>>>> master

    /**
     * get primary stage
     * @return primary stage
     */
    public Stage getPrimayStage(){
<<<<<<< HEAD
<span class="nc" id="L1092">        return primaryStage;</span>
=======
<span class="nc" id="L1091">        return primaryStage;</span>
>>>>>>> master
    }


    public boolean isSurvivalMode() {
<<<<<<< HEAD
<span class="nc" id="L1097">        return isSurvivalMode;</span>
    }

    public AnchorPane getStats() {
<span class="nc" id="L1101">        return stats;</span>
    }

    public void closeStore(){
<span class="nc" id="L1105">        heroCastleBuilding.closeStore();</span>
<span class="nc" id="L1106">    }</span>

    public void setMainMenuController(MainMenuController mainMenuController){
<span class="nc" id="L1109">        this.mainMenuController = mainMenuController;</span>
<span class="nc" id="L1110">    }</span>

    public ModeReq getModeReq(){
<span class="nc" id="L1113">        return mainMenuController.getMode_req();</span>
=======
<span class="nc" id="L1096">        return isSurvivalMode;</span>
    }

    public AnchorPane getStats() {
<span class="nc" id="L1100">        return stats;</span>
    }

    public void closeStore(){
<span class="nc" id="L1104">        heroCastleBuilding.closeStore();</span>
<span class="nc" id="L1105">    }</span>

    public void setMainMenuController(MainMenuController mainMenuController){
<span class="nc" id="L1108">        this.mainMenuController = mainMenuController;</span>
<span class="nc" id="L1109">    }</span>

    public ModeReq getModeReq(){
<span class="nc" id="L1112">        return mainMenuController.getMode_req();</span>
>>>>>>> master
    }

    /**
     * we added this method to help with debugging so you could check your code is running on the application thread.
     * By running everything on the application thread, you will not need to worry about implementing locks, which is outside the scope of the course.
     * Always writing code running on the application thread will make the project easier, as long as you are not running time-consuming tasks.
     * We recommend only running code on the application thread, by using Timelines when you want to run multiple processes at once.
     * EventHandlers will run on the application thread.
     */
    private void printThreadingNotes(String currentMethodLabel){
        // System.out.println(&quot;\n###########################################&quot;);
        // System.out.println(&quot;current method = &quot;+currentMethodLabel);
        // System.out.println(&quot;In application thread? = &quot;+Platform.isFxApplicationThread());
        // System.out.println(&quot;Current system time = &quot;+java.time.LocalDateTime.now().toString().replace('T', ' '));
<<<<<<< HEAD
<span class="nc" id="L1128">    }</span>
=======
<span class="nc" id="L1127">    }</span>
>>>>>>> master

    /**
     * set the one ring image to balck tiny when used it 
     */
    public void setUsedTheOneRingImage() {
<<<<<<< HEAD
<span class="nc bnc" id="L1134" title="All 2 branches missed.">        if (world.getCharacter().getTheOneRing() == null) {</span>
<span class="nc" id="L1135">            ImageView image = new ImageView(BlackTinyImage);</span>
<span class="nc" id="L1136">            equippedItems.add(image, 3, 0, 1, 1);</span>
<span class="nc" id="L1137">            world.setUsedTheOneRing(false);</span>
        }
<span class="nc" id="L1139">    }</span>
=======
<span class="nc bnc" id="L1133" title="All 2 branches missed.">        if (world.getCharacter().getTheOneRing() == null) {</span>
<span class="nc" id="L1134">            ImageView image = new ImageView(emptyTheOneRingImage);</span>
<span class="nc" id="L1135">            equippedItems.add(image, 3, 0, 1, 1);</span>
<span class="nc" id="L1136">            world.setUsedTheOneRing(false);</span>
        }
<span class="nc" id="L1138">    }</span>
>>>>>>> master
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>